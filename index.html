<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>M-Coin City: Global Leaderboard</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --m-red: #e31b23; --m-green: #00a650; --m-blue: #008dce; --m-gold: #f9a825; --bg: #f0e6d2; }
        body { font-family: 'Arial Black', sans-serif; background: var(--bg); margin: 0; padding: 0; user-select: none; overflow: hidden; height: 100vh; }

        /* Dashboard & Header */
        .header { background: var(--m-red); color: white; padding: 12px; display: flex; justify-content: space-between; border-bottom: 5px solid #222; font-size: 12px; }
        
        /* Stats Panel */
        .stats-panel { background: white; border: 4px solid #333; margin: 10px auto; width: 90%; border-radius: 15px; padding: 10px; text-align: center; box-shadow: 5px 5px 0px #333; }
        .coin-val { font-size: 38px; color: var(--m-green); font-weight: bold; display: block; }
        .income-info { font-size: 12px; color: #555; }

        /* Board - City Core */
        #game-board { width: 180px; height: 180px; background: white; border: 10px solid #333; margin: 15px auto; border-radius: 50%; display: flex; align-items: center; justify-content: center; position: relative; transition: 0.1s; cursor: pointer; }
        #game-board:active { transform: scale(0.92) rotate(-3deg); }
        #game-board img { width: 110px; }

        /* Resource Indicators */
        .resource-wrap { padding: 0 20px; }
        .label { font-size: 10px; font-weight: bold; margin: 2px 0; display: block; }
        .bar-outer { width: 100%; height: 14px; background: #333; border-radius: 7px; overflow: hidden; border: 2px solid #333; margin-bottom: 8px; }
        #en-bar { width: 100%; height: 100%; background: var(--m-gold); transition: 0.2s; }
        #xp-bar { width: 0%; height: 100%; background: var(--m-blue); transition: 0.5s; }

        /* Bottom Menu */
        .bottom-nav { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; padding: 10px; background: #fff; border-top: 4px solid #333; position: fixed; bottom: 0; width: 100%; box-sizing: border-box; }
        .nav-btn { background: #eee; border: 3px solid #333; padding: 8px; border-radius: 8px; font-size: 10px; font-weight: bold; text-align: center; cursor: pointer; }
        .nav-btn.active { background: var(--m-blue); color: white; }

        /* Modal Screens (Maya & Leaderboard) */
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 10000; display: none; flex-direction: column; align-items: center; justify-content: center; }
        .overlay.active { display: flex; }
        .maya-img { width: 150px; margin-bottom: 10px; }
        .speech-bubble { background: white; border: 4px solid #333; padding: 15px; border-radius: 15px; width: 80%; text-align: center; font-weight: bold; }
        .btn-action { margin-top: 15px; background: var(--m-gold); border: 3px solid #333; padding: 10px 30px; border-radius: 10px; font-weight: bold; }

        /* Leaderboard Table */
        .rank-table { width: 85%; background: white; border: 4px solid #333; border-radius: 15px; padding: 10px; max-height: 60vh; overflow-y: auto; }
        .rank-row { display: flex; justify-content: space-between; padding: 8px; border-bottom: 2px solid #eee; font-size: 12px; }
        .rank-row.me { background: #fff9c4; font-weight: bold; }
    </style>
</head>
<body>

<div class="header">
    <div id="rank-name">ğŸ–ï¸ ADAY ADAYI</div>
    <div id="level-val">Lv. 1</div>
</div>

<div class="stats-panel">
    <span class="coin-val">ğŸª™ <span id="coin-text">0</span></span>
    <span class="income-info">Pasif: +<span id="pps-text">0</span>/sn</span>
</div>

<div id="game-board" onclick="handleTap(event)">
    <img id="city-img" src="https://cdn-icons-png.flaticon.com/512/619/619153.png">
</div>

<div class="resource-wrap">
    <span class="label">âš¡ ENERJÄ°: <span id="en-text">1000</span></span>
    <div class="bar-outer"><div id="en-bar"></div></div>
    <span class="label">ğŸ“ˆ XP (Level Ä°lerlemesi)</span>
    <div class="bar-outer"><div id="xp-bar"></div></div>
</div>

<div class="bottom-nav">
    <div class="nav-btn active" onclick="showScreen('main')">ğŸ›ï¸ ÅEHÄ°R</div>
    <div class="nav-btn" onclick="showScreen('shop')">ğŸª MARKET</div>
    <div class="nav-btn" onclick="showScreen('rank')">ğŸ† SIRALAMA</div>
</div>

<div id="maya-overlay" class="overlay">
    <img src="assets/maya.png" class="maya-img" onerror="this.src='https://i.ibb.co/v4S8W5p/maya-cartoon.png'">
    <div id="maya-msg" class="speech-bubble">HoÅŸ geldiniz BaÅŸkanÄ±m! Åehrimizi dÃ¼nyaya duyurma vakti geldi.</div>
    <button class="btn-action" onclick="closeMaya()">EMRET!</button>
</div>

<div id="rank-overlay" class="overlay">
    <h2 style="color:white;">ğŸŒ DÃœNYA SIRALAMASI</h2>
    <div class="rank-table">
        <div class="rank-row"><span>1. Elon M.</span><span>999.9M ğŸª™</span></div>
        <div class="rank-row"><span>2. Jeff B.</span><span>850.2M ğŸª™</span></div>
        <div class="rank-row me"><span>124. SEN (BAÅKAN)</span><span id="my-rank-coin">0 ğŸª™</span></div>
        </div>
    <button class="btn-action" onclick="closeRank()">KAPAT</button>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    let state = JSON.parse(localStorage.getItem('mcity_final_v9')) || {
        coins: 0, energy: 1000, pps: 0, lv: 1, xp: 0, nextXp: 500, first: true
    };

    function updateUI() {
        document.getElementById('coin-text').innerText = Math.floor(state.coins).toLocaleString();
        document.getElementById('my-rank-coin').innerText = Math.floor(state.coins).toLocaleString() + " ğŸª™";
        document.getElementById('pps-text').innerText = state.pps.toFixed(1);
        document.getElementById('en-text').innerText = Math.floor(state.energy);
        document.getElementById('en-bar').style.width = (state.energy / 10) + "%";
        document.getElementById('xp-bar').style.width = (state.xp / state.nextXp * 100) + "%";
        document.getElementById('level-val').innerText = "Lv. " + state.lv;
        
        if(state.lv > 5) document.getElementById('rank-name').innerText = "ğŸ™ï¸ ÅEHÄ°R PLANLAMA";
        if(state.lv > 15) document.getElementById('rank-name').innerText = "ğŸ›ï¸ METROPOL BAÅKANI";
        
        localStorage.setItem('mcity_final_v9', JSON.stringify(state));
    }

    function handleTap(e) {
        if (state.energy >= 1) {
            let gain = 1 + Math.floor(state.lv / 3);
            state.coins += gain;
            state.energy -= 1;
            state.xp += 10;
            if (state.xp >= state.nextXp) levelUp();
            updateUI();
            tg.HapticFeedback.impactOccurred('medium');
        } else {
            mayaMesaj("BaÅŸkanÄ±m enerji tÃ¼kendi, halkÄ±n dinlenmesi lazÄ±m!");
        }
    }

    function levelUp() {
        state.lv++;
        state.xp = 0;
        state.nextXp *= 2.5;
        state.energy = 1000;
        mayaMesaj("TEBRÄ°KLER! Seviye AtladÄ±k. Åehir artÄ±k daha gÃ¶rkemli!");
    }

    function showScreen(name) {
        if(name === 'rank') {
            document.getElementById('rank-overlay').classList.add('active');
        } else if(name === 'shop') {
            mayaMesaj("Market yakÄ±nda geniÅŸletilecek! Åimdilik fÄ±rÄ±nlara devam.");
        }
    }

    function closeRank() { document.getElementById('rank-overlay').classList.remove('active'); }

    function mayaMesaj(m) {
        document.getElementById('maya-msg').innerText = m;
        document.getElementById('maya-overlay').classList.add('active');
    }

    function closeMaya() { document.getElementById('maya-overlay').classList.remove('active'); }

    setInterval(() => {
        state.coins += (state.pps / 10);
        if (state.energy < 1000) state.energy += 0.5;
        updateUI();
    }, 100);

    window.onload = () => {
        updateUI();
        if(state.first) {
            setTimeout(() => mayaMesaj("HoÅŸ geldiniz BaÅŸkanÄ±m! Ben Maya. Åehrimizi beraber yÃ¶neteceÄŸiz."), 500);
            state.first = false;
        }
    };
</script>
</body>
</html>
