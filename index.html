<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>M-Coin City</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --monopoly-green: #1f7a31;
            --monopoly-red: #d32f2f;
            --monopoly-blue: #0077b6;
            --bg-color: #f0e6d2;
        }

        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background-color: var(--bg-color); 
            margin: 0; 
            padding: 0; 
            user-select: none;
            overflow: hidden;
        }

        /* √úst Panel */
        .header {
            background: var(--monopoly-red);
            color: white;
            padding: 15px;
            text-align: center;
            border-bottom: 6px solid #8b0000;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        /* M-Coin G√∂stergesi */
        .balance-container {
            font-size: 36px;
            font-weight: bold;
            color: var(--monopoly-green);
            margin: 20px 0;
            text-shadow: 1px 1px 0px #fff;
        }

        /* Oyun Alanƒ± / ≈ûehir */
        #city-board {
            width: 280px;
            height: 280px;
            background: white;
            border: 12px solid #333;
            border-radius: 15px;
            margin: 0 auto;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            transition: transform 0.05s active;
        }

        #city-board:active { transform: scale(0.96); }

        #city-image { width: 180px; pointer-events: none; }

        /* Enerji Barƒ± */
        .energy-container {
            width: 80%;
            height: 20px;
            background: #ccc;
            margin: 20px auto;
            border-radius: 10px;
            border: 2px solid #333;
            overflow: hidden;
        }

        #energy-fill {
            width: 100%;
            height: 100%;
            background: linear-gradient(to right, #fbc02d, #f57f17);
            transition: width 0.3s;
        }

        /* ƒ∞statistikler */
        .stats {
            display: flex;
            justify-content: space-around;
            padding: 10px;
            background: #fff;
            border-top: 2px solid #333;
            font-weight: bold;
        }

        /* Market / Butonlar */
        .actions { padding: 20px; }

        .btn {
            width: 100%;
            padding: 15px;
            margin-bottom: 10px;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: bold;
            color: white;
            cursor: pointer;
            box-shadow: 0 4px 0px rgba(0,0,0,0.2);
        }

        .btn-green { background-color: var(--monopoly-green); }
        .btn-blue { background-color: var(--monopoly-blue); }

        /* Tƒ±klama Efekti */
        .floating-text {
            position: absolute;
            font-weight: bold;
            color: var(--monopoly-green);
            pointer-events: none;
            animation: floatUp 0.8s ease-out forwards;
        }

        @keyframes floatUp {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-100px); opacity: 0; }
        }
    </style>
</head>
<body>

    <div class="header">
        <span id="player-title">BA≈ûKAN</span>
    </div>

    <div class="balance-container">
        ü™ô <span id="balance">0</span>
    </div>

    <div id="city-board" onclick="handleTap(event)">
        <img id="city-image" src="https://cdn-icons-png.flaticon.com/512/619/619153.png" alt="City">
    </div>

    <div class="energy-container">
        <div id="energy-fill"></div>
    </div>
    <div style="font-weight: bold; margin-top: -15px;">‚ö° <span id="energy-val">1000</span>/1000</div>

    <div class="stats">
        <div>Tƒ±k: +<span id="click-pwr">1</span></div>
        <div>Pasif: <span id="passive-val">0</span>/sn</div>
    </div>

    <div class="actions">
        <button class="btn btn-green" onclick="buyUpgrade('firin', 100, 2)">Ekmek Fƒ±rƒ±nƒ± Al (100 M-Coin)</button>
        <button class="btn btn-blue" onclick="startWar()">Sava≈ü Ba≈ülat ‚öîÔ∏è</button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        let state = {
            mCoins: 0,
            clickPower: 1,
            passiveIncome: 0,
            energy: 1000,
            maxEnergy: 1000
        };

        // Verileri Y√ºkle
        const savedData = localStorage.getItem('mcity_save');
        if(savedData) {
            state = JSON.parse(savedData);
        }

        function updateUI() {
            document.getElementById('balance').innerText = Math.floor(state.mCoins);
            document.getElementById('click-pwr').innerText = state.clickPower;
            document.getElementById('passive-val').innerText = state.passiveIncome;
            document.getElementById('energy-val').innerText = Math.floor(state.energy);
            document.getElementById('energy-fill').style.width = (state.energy / state.maxEnergy * 100) + "%";
        }

        function handleTap(event) {
            if (state.energy >= 1) {
                state.mCoins += state.clickPower;
                state.energy -= 1;
                showEffect(event.clientX, event.clientY, "+" + state.clickPower);
                updateUI();
                save();
            } else {
                tg.HapticFeedback.notificationOccurred('error');
            }
        }

        function buyUpgrade(type, cost, power) {
            if (state.mCoins >= cost) {
                state.mCoins -= cost;
                state.passiveIncome += power;
                updateUI();
                save();
                tg.HapticFeedback.impactOccurred('medium');
            } else {
                tg.showAlert("Yetersiz M-Coin!");
            }
        }

        function startWar() {
            if (state.mCoins < 50) return tg.showAlert("Sava≈ü i√ßin en az 50 M-Coin lazƒ±m!");
            
            let win = Math.random() > 0.5;
            if (win) {
                let gain = Math.floor(state.mCoins * 0.1) + 50;
                state.mCoins += gain;
                tg.showAlert("ZAFER! Ba≈üka bir ≈üehirden " + gain + " M-Coin ganimet topladƒ±n!");
            } else {
                state.mCoins -= 50;
                tg.showAlert("BOZGUN! 50 M-Coin kaybettin.");
            }
            updateUI();
            save();
        }

        function showEffect(x, y, text) {
            const div = document.createElement('div');
            div.className = 'floating-text';
            div.style.left = x + 'px';
            div.style.top = y + 'px';
            div.innerText = text;
            document.body.appendChild(div);
            setTimeout(() => div.remove(), 800);
        }

        function save() {
            localStorage.setItem('mcity_save', JSON.stringify(state));
        }

        // Enerji ve Pasif Gelir D√∂ng√ºs√º
        setInterval(() => {
            if (state.energy < state.maxEnergy) state.energy += 0.5;
            state.mCoins += (state.passiveIncome / 10);
            updateUI();
        }, 100);

        updateUI();
    </script>
</body>
</html>
