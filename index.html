<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>M-Coin City: Financial Empire</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --m-black: #0F172A; --m-blue: #3B82F6; --m-green: #10B981; --m-gold: #F59E0B; --m-gray: #1E293B; }
        body { font-family: 'Inter', sans-serif; background: var(--m-black); margin: 0; padding: 0; color: #F8FAFC; user-select: none; overflow: hidden; }

        /* --- ÃœST PANEL (Modern Finansal Kaynaklar) --- */
        .dashboard {
            background: rgba(30, 41, 59, 0.9); backdrop-filter: blur(10px);
            display: grid; grid-template-columns: repeat(4, 1fr);
            padding: 12px 5px; border-bottom: 2px solid var(--m-blue);
        }
        .res-box { text-align: center; }
        .res-box img { width: 22px; height: 22px; margin-bottom: 4px; }
        .res-box span { display: block; font-size: 13px; font-weight: 800; }
        .val-cash { color: var(--m-green); } /* PARA */
        .val-data { color: var(--m-blue); }  /* VERÄ° */
        .val-energy { color: var(--m-gold); } /* ENERJÄ° */
        .val-fame { color: #EC4899; }        /* Ä°TÄ°BAR */

        /* --- ÅžEHÄ°R HARÄ°TASI (Modern City View) --- */
        .map-view {
            width: 100%; height: 340px; 
            background: url('https://images.unsplash.com/photo-1477959858617-67f85cf4f1df?q=80&w=1000&auto=format&fit=crop') center/cover;
            position: relative; border-bottom: 3px solid #000;
        }

        .plot {
            position: absolute; width: 75px; height: 75px;
            background: rgba(255,255,255,0.1); border: 2px solid rgba(59, 130, 246, 0.5);
            border-radius: 12px; display: flex; flex-direction: column; align-items: center; justify-content: center;
            cursor: pointer; transition: 0.3s; backdrop-filter: blur(4px);
        }
        .plot:active { transform: scale(0.9); border-color: #FFF; }
        .plot img { width: 50px; height: 50px; display: none; filter: drop-shadow(0 0 10px rgba(0,0,0,0.5)); }
        .plot.active img { display: block; }
        .plot b { font-size: 8px; color: #FFF; text-align: center; margin-top: 4px; text-transform: uppercase; }

        /* Konumlar */
        .p1 { top: 40px; left: 15%; } .p2 { top: 40px; right: 15%; }
        .p-hq { top: 125px; left: 50%; transform: translateX(-50%); width: 90px; height: 90px; border: 3px solid var(--m-gold); }
        .p3 { bottom: 40px; left: 15%; } .p4 { bottom: 40px; right: 15%; }

        /* --- Ä°NÅžAAT DURUMU --- */
        .status-bar {
            background: var(--m-blue); color: #FFF; padding: 10px; margin: 10px;
            border-radius: 8px; font-weight: bold; text-align: center; font-size: 12px;
            display: none; animation: pulse 2s infinite;
        }
        @keyframes pulse { 0% {opacity: 1;} 50% {opacity: 0.7;} 100% {opacity: 1;} }

        /* --- MAYA STRATEJÄ°ST PANELÄ° --- */
        .maya-advisor {
            background: var(--m-gray); padding: 15px; border-top: 2px solid #334155;
            display: flex; align-items: center; gap: 15px;
        }
        .maya-img { 
            width: 55px; height: 55px; border-radius: 15px; 
            border: 2px solid var(--m-blue); background: url('https://img.freepik.com/free-vector/beauty-robot-portrait-concept_23-2148474271.jpg') center/cover;
        }
        .maya-msg { flex: 1; font-size: 12px; color: #94A3B8; line-height: 1.5; }

        /* --- MODERN BÄ°NA MENÃœSÃœ --- */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); display: none; align-items: center; justify-content: center; z-index: 100;
        }
        .modal-content {
            background: var(--m-gray); width: 85%; border: 2px solid var(--m-blue); border-radius: 20px; padding: 20px;
        }
        .build-card {
            display: flex; align-items: center; gap: 12px; padding: 15px 0; border-bottom: 1px solid #334155;
        }
        .build-card img { width: 40px; height: 40px; border-radius: 8px; }
        .build-info { flex: 1; font-size: 11px; }
        .btn-build { background: var(--m-blue); color: #FFF; border: none; padding: 8px 15px; border-radius: 6px; font-weight: 800; cursor: pointer; }

        .nav { display: grid; grid-template-columns: repeat(3, 1fr); background: #000; position: fixed; bottom: 0; width: 100%; }
        .nav-btn { padding: 18px; text-align: center; font-size: 12px; font-weight: bold; border-top: 2px solid var(--m-gray); color: #64748B; }
        .nav-btn.active { color: var(--m-blue); border-color: var(--m-blue); }
    </style>
</head>
<body>

<div class="dashboard">
    <div class="res-box">
        <img src="https://cdn-icons-png.flaticon.com/512/2489/2489756.png"> <span id="cash-val" class="val-cash">500</span>
    </div>
    <div class="res-box">
        <img src="https://cdn-icons-png.flaticon.com/512/2103/2103633.png"> <span id="data-val" class="val-data">200</span>
    </div>
    <div class="res-box">
        <img src="https://cdn-icons-png.flaticon.com/512/2906/2906236.png"> <span id="energy-val" class="val-energy">150</span>
    </div>
    <div class="res-box">
        <img src="https://cdn-icons-png.flaticon.com/512/3112/3112946.png"> <span id="fame-val" class="val-fame">50</span>
    </div>
</div>

<div class="map-view">
    <div id="p1" class="plot p1" onclick="openBuild(1)"><b>YAZILIM OFÄ°SÄ°</b><img src="https://cdn-icons-png.flaticon.com/512/1055/1055666.png"></div>
    <div id="p2" class="plot p2" onclick="openBuild(2)"><b>VERÄ° MERKEZÄ°</b><img src="https://cdn-icons-png.flaticon.com/512/2885/2885417.png"></div>
    <div class="plot p-hq active"><b>ANA MERKEZ</b><img src="https://cdn-icons-png.flaticon.com/512/2099/2099143.png"></div>
    <div id="p3" class="plot p3" onclick="openBuild(3)"><b>YATIRIM BANKASI</b><img src="https://cdn-icons-png.flaticon.com/512/2830/2830284.png"></div>
    <div id="p4" class="plot p4" onclick="openBuild(4)"><b>AR-GE TESÄ°SÄ°</b><img src="https://cdn-icons-png.flaticon.com/512/4300/4300058.png"></div>
</div>

<div id="build-status" class="status-bar">
    âš¡ Ä°ÅŸlem YapÄ±lÄ±yor: <span id="task-name"></span> - <b id="task-timer">0</b>s
</div>

<div class="maya-advisor">
    <div class="maya-img"></div>
    <div class="maya-msg" id="maya-text">BaÅŸkanÄ±m, dijital Ã§aÄŸda veri her ÅŸeydir. Bir Veri Merkezi kurarak itibarÄ±mÄ±zÄ± ve nakit akÄ±ÅŸÄ±mÄ±zÄ± gÃ¼Ã§lendirebiliriz.</div>
</div>

<div id="modal-build" class="modal">
    <div class="modal-content">
        <h2 style="margin-top:0; color:var(--m-blue); font-size:18px;">STRATEJÄ°K YATIRIM</h2>
        
        <div class="build-card">
            <img src="https://cdn-icons-png.flaticon.com/512/1055/1055666.png">
            <div class="build-info">
                <b>YAZILIM OFÄ°SÄ°</b><br>KazanÃ§: +15 Para/sa<br>Maliyet: 200 ðŸ’µ 100 ðŸ’¾
            </div>
            <button class="btn-build" onclick="startInvest('YazÄ±lÄ±m Ofisi', 200, 100, 0, 15, 1)">KUR</button>
        </div>

        <div class="build-card">
            <img src="https://cdn-icons-png.flaticon.com/512/2885/2885417.png">
            <div class="build-info">
                <b>VERÄ° MERKEZÄ°</b><br>KazanÃ§: +20 Veri/sa<br>Maliyet: 300 ðŸ’µ 150 âš¡
            </div>
            <button class="btn-build" onclick="startInvest('Veri Merkezi', 300, 0, 150, 20, 2)">KUR</button>
        </div>

        <button onclick="closeModal()" style="width:100%; margin-top:20px; background:transparent; color:#64748B; border:none; font-weight:bold;">VAZGEÃ‡</button>
    </div>
</div>

<div class="nav">
    <div class="nav-btn active">ÅžEHÄ°R</div>
    <div class="nav-btn" onclick="tg.showAlert('Global Borsa YakÄ±nda!')">BORSA</div>
    <div class="nav-btn" onclick="location.reload()">YENÄ°LE</div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    let state = JSON.parse(localStorage.getItem('mcity_modern_v1')) || {
        res: { cash: 500, data: 200, energy: 150, fame: 50 },
        prod: { cash: 5, data: 2, energy: 2, fame: 1 },
        buildings: { 1: null, 2: null, 3: null, 4: null },
        activeInvest: null
    };

    let selectedPlot = null;

    function updateUI() {
        document.getElementById('cash-val').innerText = Math.floor(state.res.cash);
        document.getElementById('data-val').innerText = Math.floor(state.res.data);
        document.getElementById('energy-val').innerText = Math.floor(state.res.energy);
        document.getElementById('fame-val').innerText = Math.floor(state.res.fame);

        for (let i = 1; i <= 4; i++) {
            const site = document.getElementById('p' + i);
            if (state.buildings[i]) {
                site.classList.add('active');
                site.querySelector('b').innerText = state.buildings[i];
            }
        }

        if (state.activeInvest) {
            document.getElementById('build-status').style.display = 'block';
            document.getElementById('task-name').innerText = state.activeInvest.name;
            document.getElementById('task-timer').innerText = state.activeInvest.timeLeft;
        } else {
            document.getElementById('build-status').style.display = 'none';
        }
        localStorage.setItem('mcity_modern_v1', JSON.stringify(state));
    }

    function openBuild(id) {
        if (state.buildings[id]) return;
        if (state.activeInvest) { tg.showAlert("Bir iÅŸlem zaten yÃ¼rÃ¼tÃ¼lÃ¼yor!"); return; }
        selectedPlot = id;
        document.getElementById('modal-build').style.display = 'flex';
    }

    function closeModal() { document.getElementById('modal-build').style.display = 'none'; }

    function startInvest(name, cash, data, energy, time, typeId) {
        if (state.res.cash >= cash && state.res.data >= data) {
            state.res.cash -= cash;
            state.res.data -= data;
            state.activeInvest = { name: name, timeLeft: time, plot: selectedPlot, typeId: typeId };
            closeModal();
            updateUI();
            tg.HapticFeedback.notificationOccurred('success');
        } else {
            tg.showAlert("Yetersiz sermaye!");
        }
    }

    // Modern Zaman DÃ¶ngÃ¼sÃ¼
    setInterval(() => {
        state.res.cash += state.prod.cash / 10;
        state.res.data += state.prod.data / 10;
        state.res.energy += state.prod.energy / 10;
        state.res.fame += state.prod.fame / 10;

        if (state.activeInvest) {
            state.activeInvest.timeLeft--;
            if (state.activeInvest.timeLeft <= 0) {
                const b = state.activeInvest;
                state.buildings[b.plot] = b.name;
                if (b.typeId === 1) state.prod.cash += 15;
                if (b.typeId === 2) state.prod.data += 20;
                state.activeInvest = null;
                document.getElementById('maya-text').innerText = "BaÅŸkanÄ±m, " + b.name + " yatÄ±rÄ±mÄ± tamamlandÄ±. Dijital gÃ¼cÃ¼mÃ¼z artÄ±yor!";
            }
        }
        updateUI();
    }, 1000);

    updateUI();
</script>
</body>
</html>
