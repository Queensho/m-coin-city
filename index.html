<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>M-Coin City</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --m-red: #E31B23; --m-green: #00A650; --m-blue: #008DCE; --m-yellow: #FFF200; --bg: #F0E6D2; }
        body { font-family: 'Arial Black', sans-serif; background: var(--bg); margin: 0; padding: 0; user-select: none; color: #333; overflow-x: hidden; }
        
        /* Ãœst Panel */
        .header { background: var(--m-red); color: white; padding: 10px; border-bottom: 4px solid #333; display: flex; justify-content: space-between; font-size: 14px; }
        
        .balance-card { background: white; border: 4px solid #333; margin: 15px; padding: 10px; border-radius: 10px; text-align: center; box-shadow: 5px 5px 0px #333; }
        .coin-val { font-size: 32px; color: var(--m-green); }

        /* Ana TÄ±klama AlanÄ± */
        #game-area { position: relative; width: 200px; height: 200px; margin: 20px auto; cursor: pointer; }
        #city-building { width: 100%; transition: transform 0.1s; }
        #game-area:active #city-building { transform: scale(0.92); }

        /* Maya GÃ¶rseli */
        #maya-character {
            position: fixed;
            bottom: 0;
            right: -20px;
            width: 180px;
            z-index: 10;
            pointer-events: none;
            transition: transform 0.3s;
        }

        /* KonuÅŸma Balonu */
        #dialog {
            position: fixed;
            bottom: 120px;
            left: 20px;
            right: 100px;
            background: white;
            border: 3px solid #333;
            padding: 10px;
            border-radius: 15px;
            font-size: 13px;
            font-weight: bold;
            z-index: 11;
            box-shadow: 4px 4px 0px #333;
            display: none;
        }

        /* Barlar */
        .stats-container { padding: 0 20px; position: relative; z-index: 5; }
        .bar-bg { width: 100%; height: 18px; background: #333; border-radius: 9px; margin: 5px 0; overflow: hidden; border: 2px solid #333; }
        #energy-bar { width: 100%; height: 100%; background: var(--m-yellow); transition: width 0.2s; }
        #xp-bar { width: 0%; height: 100%; background: var(--m-blue); transition: width 0.5s; }

        .shop-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 15px; position: relative; z-index: 5; }
        .item { background: white; border: 3px solid #333; padding: 8px; border-radius: 8px; text-align: center; font-size: 11px; }
        button { background: var(--m-green); color: white; border: 2px solid #333; width: 100%; padding: 5px; margin-top: 5px; font-weight: bold; cursor: pointer; }

        .plus-one { position: absolute; color: var(--m-green); font-weight: bold; animation: fly 0.6s forwards; }
        @keyframes fly { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-100px); } }
    </style>
</head>
<body>

<div class="header">
    <span id="rank-text">BAÅKAN YARDIMCISI</span>
    <span id="lv-text">Lv. 1</span>
</div>

<div class="balance-card">
    <div class="coin-val">ğŸª™ <span id="coin-count">0</span></div>
    <div style="font-size: 11px;">Gelir: <span id="pps">0</span>/sn</div>
</div>

<div id="game-area" onclick="tap(event)">
    <img id="city-building" src="https://cdn-icons-png.flaticon.com/512/619/619153.png">
</div>

<div class="stats-container">
    <div style="font-size: 10px; font-weight: bold;">âš¡ ENERJÄ°: <span id="en-num">1000</span></div>
    <div class="bar-bg"><div id="energy-bar"></div></div>
    <div style="font-size: 10px; font-weight: bold;">ğŸ“ˆ ÅEHÄ°R TECRÃœBESÄ°</div>
    <div class="bar-bg"><div id="xp-bar"></div></div>
</div>

<div class="shop-grid">
    <div class="item">ğŸ‹ LÄ°MONATACI<br>+2/sn<br><button onclick="buy(150, 2, 'Harika! Halk susamÄ±ÅŸtÄ±.')">150 ğŸª™</button></div>
    <div class="item">ğŸª BAKKAL<br>+8/sn<br><button onclick="buy(800, 8, 'Ekonomi canlanÄ±yor baÅŸkanÄ±m!')">800 ğŸª™</button></div>
</div>

<div id="dialog">BaÅŸkanÄ±m, ÅŸehrimizi bÃ¼yÃ¼tmek iÃ§in belediyeye tÄ±klayÄ±n!</div>
<img id="maya-character" src="https://i.ibb.co/v4S8W5p/maya-cartoon.png" alt="Sekreter Maya">

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    let state = JSON.parse(localStorage.getItem('mcity_final')) || {
        coins: 0, energy: 1000, maxEn: 1000, xp: 0, nextXp: 500, lv: 1, pps: 0
    };

    function update() {
        document.getElementById('coin-count').innerText = Math.floor(state.coins);
        document.getElementById('pps').innerText = state.pps.toFixed(1);
        document.getElementById('en-num').innerText = Math.floor(state.energy);
        document.getElementById('energy-bar').style.width = (state.energy / state.maxEn * 100) + "%";
        document.getElementById('xp-bar').style.width = (state.xp / state.nextXp * 100) + "%";
        document.getElementById('lv-text').innerText = "Lv. " + state.lv;
        localStorage.setItem('mcity_final', JSON.stringify(state));
    }

    function tap(e) {
        if (state.energy >= 1) {
            let gain = 1 + Math.floor(state.lv / 2);
            state.coins += gain;
            state.energy -= 1;
            state.xp += 5;
            if (state.xp >= state.nextXp) {
                state.lv++; state.xp = 0; state.nextXp *= 2; state.maxEn += 200; state.energy = state.maxEn;
                speak("TEBRÄ°KLER! Åehrimiz seviye atladÄ±!");
            }
            createFloat(e.clientX, e.clientY, "+" + gain);
            update();
            tg.HapticFeedback.impactOccurred('medium');
        }
    }

    function buy(cost, inc, msg) {
        if (state.coins >= cost) {
            state.coins -= cost;
            state.pps += inc;
            speak(msg);
            update();
        } else { speak("ÃœzgÃ¼nÃ¼m baÅŸkanÄ±m, yeterli M-Coin yok."); }
    }

    function speak(text) {
        const d = document.getElementById('dialog');
        d.innerText = text;
        d.style.display = 'block';
        setTimeout(() => { d.style.display = 'none'; }, 3000);
    }

    function createFloat(x, y, t) {
        const div = document.createElement('div');
        div.className = 'plus-one';
        div.style.left = x + 'px'; div.style.top = y + 'px';
        div.innerText = t;
        document.body.appendChild(div);
        setTimeout(() => div.remove(), 600);
    }

    setInterval(() => {
        state.coins += (state.pps / 10);
        if (state.energy < state.maxEn) state.energy += 0.4;
        update();
    }, 100);

    // BaÅŸlangÄ±Ã§ KarÅŸÄ±lamasÄ±
    setTimeout(() => { speak("HoÅŸ geldiniz baÅŸkanÄ±m! Åehri ayaÄŸa kaldÄ±ralÄ±m."); }, 1000);

    update();
</script>
</body>
</html>
