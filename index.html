<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>M-Coin City: Rise of President</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --m-red: #e31b23; --m-green: #00a650; --m-blue: #008dce; --m-gold: #f9a825; --bg: #f0e6d2; }
        body { font-family: 'Arial Black', sans-serif; background: var(--bg); margin: 0; padding: 0; user-select: none; overflow: hidden; height: 100vh; }

        /* Dashboard */
        .status-bar { background: #333; color: white; padding: 5px 15px; display: flex; justify-content: space-between; font-size: 10px; letter-spacing: 1px; }
        .header { background: var(--m-red); color: white; padding: 15px; display: flex; justify-content: space-between; border-bottom: 6px solid #222; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        
        /* Stats Card */
        .main-stats { background: white; border: 4px solid #333; margin: 10px auto; width: 90%; border-radius: 15px; padding: 15px; text-align: center; box-shadow: 6px 6px 0px #333; position: relative; }
        .coin-val { font-size: 40px; color: var(--m-green); display: block; }
        .income-val { font-size: 14px; color: #555; font-weight: bold; }

        /* Game Core */
        #city-action { width: 190px; height: 190px; background: white; border: 10px solid #333; margin: 15px auto; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; position: relative; box-shadow: 0 10px 20px rgba(0,0,0,0.1); transition: 0.05s; }
        #city-action:active { transform: scale(0.94) rotate(2deg); }
        #city-action img { width: 120px; }

        /* Resource Bars */
        .bars { padding: 0 20px; }
        .bar-label { font-size: 11px; font-weight: bold; margin: 4px 0; display: block; }
        .progress-bg { width: 100%; height: 16px; background: #333; border-radius: 8px; border: 2px solid #333; overflow: hidden; margin-bottom: 10px; }
        #energy-bar { width: 100%; height: 100%; background: var(--m-gold); transition: 0.2s; }
        #xp-bar { width: 0%; height: 100%; background: var(--m-blue); transition: 0.5s; }

        /* Build Menu */
        .build-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 15px; height: 180px; overflow-y: auto; background: rgba(0,0,0,0.05); }
        .building-card { background: white; border: 3px solid #333; border-radius: 12px; padding: 10px; text-align: center; box-shadow: 3px 3px 0 #333; transition: 0.2s; }
        .building-card:active { transform: translate(2px, 2px); box-shadow: 1px 1px 0 #333; }
        .building-card b { font-size: 12px; display: block; color: var(--m-red); }
        .building-card span { font-size: 10px; display: block; margin: 4px 0; }
        .price-tag { background: var(--m-green); color: white; font-size: 11px; padding: 3px; border-radius: 4px; border: 2px solid #333; display: block; }

        /* Maya Briefing */
        #maya-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 10000; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: 0.5s; }
        #maya-screen.hidden { transform: translateY(-100%); opacity: 0; }
        #maya-img { width: 180px; filter: drop-shadow(0 0 15px var(--m-gold)); }
        #maya-msg { background: white; border: 5px solid #333; padding: 20px; border-radius: 20px; width: 80%; text-align: center; font-weight: bold; margin-top: 20px; box-shadow: 10px 10px 0 var(--m-red); }
        .maya-btn { margin-top: 30px; background: var(--m-gold); border: 4px solid #333; padding: 15px 40px; border-radius: 15px; font-weight: bold; cursor: pointer; font-size: 18px; }

        .floating-coin { position: absolute; color: var(--m-green); font-weight: bold; font-size: 20px; pointer-events: none; animation: floatUp 0.8s forwards; }
        @keyframes floatUp { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-120px); } }
    </style>
</head>
<body>

<div class="status-bar">
    <span>ğŸ“¡ SERVER: GLOBAL-1</span>
    <span id="date-now">OCAK 2026</span>
</div>

<div id="maya-screen">
    <img id="maya-img" src="assets/maya.png" onerror="this.src='https://i.ibb.co/v4S8W5p/maya-cartoon.png'">
    <div id="maya-msg">HoÅŸ geldiniz SayÄ±n BaÅŸkan! Åehrimizin ekonomisi sizin ellerinizde. Ä°lk coinlerimizi basmaya hazÄ±r mÄ±sÄ±nÄ±z?</div>
    <button class="maya-btn" onclick="closeMaya()">EMRET BAÅKANIM!</button>
</div>

<div class="header">
    <div id="title">STAJYER BAÅKAN</div>
    <div id="level-num">Lv. 1</div>
</div>

<div class="main-stats">
    <span class="coin-val">ğŸª™ <span id="coin-total">0</span></span>
    <span class="income-val">PASÄ°F GELÄ°R: +<span id="pps-total">0</span>/sn</span>
</div>

<div id="city-action" onclick="handleTap(event)">
    <img src="https://cdn-icons-png.flaticon.com/512/619/619153.png">
</div>

<div class="bars">
    <span class="bar-label">âš¡ ENERJÄ° REZERVÄ°: <span id="en-num">1000</span></span>
    <div class="progress-bg"><div id="energy-bar"></div></div>
    
    <span class="bar-label">ğŸ“ˆ ÅEHÄ°R TECRÃœBESÄ° (XP)</span>
    <div class="progress-bg"><div id="xp-bar"></div></div>
</div>

<div class="build-grid">
    <div class="building-card" onclick="buy('LimonatacÄ±', 150, 2)">
        <b>ğŸ‹ LimonatacÄ±</b>
        <span>+2 M-Coin/sn</span>
        <div class="price-tag">150 ğŸª™</div>
    </div>
    <div class="building-card" onclick="buy('Bakkal', 1000, 12)">
        <b>ğŸª Bakkal</b>
        <span>+12 M-Coin/sn</span>
        <div class="price-tag">1k ğŸª™</div>
    </div>
    <div class="building-card" onclick="buy('Banka', 5000, 60)">
        <b>ğŸ¦ Banka</b>
        <span>+60 M-Coin/sn</span>
        <div class="price-tag">5k ğŸª™</div>
    </div>
    <div class="building-card" onclick="triggerChance()">
        <b>ğŸ² Åans KartÄ±</b>
        <span>Rastgele Olay</span>
        <div class="price-tag">500 ğŸª™</div>
    </div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    let db = JSON.parse(localStorage.getItem('mcity_final_v1')) || {
        coins: 0, energy: 1000, pps: 0, lv: 1, xp: 0, nextXp: 500
    };

    function update() {
        document.getElementById('coin-total').innerText = Math.floor(db.coins).toLocaleString();
        document.getElementById('pps-total').innerText = db.pps.toFixed(1);
        document.getElementById('en-num').innerText = Math.floor(db.energy);
        document.getElementById('energy-bar').style.width = (db.energy / 10) + "%";
        document.getElementById('xp-bar').style.width = (db.xp / db.nextXp * 100) + "%";
        document.getElementById('level-num').innerText = "Lv. " + db.lv;
        
        if(db.lv > 3) document.getElementById('title').innerText = "ğŸ™ï¸ ÅEHÄ°R PLANLAMA";
        if(db.lv > 7) document.getElementById('title').innerText = "ğŸ›ï¸ BELEDÄ°YE BAÅKANI";
        
        localStorage.setItem('mcity_final_v1', JSON.stringify(db));
    }

    function handleTap(e) {
        if (db.energy >= 1) {
            let gain = 1 + Math.floor(db.lv / 2);
            db.coins += gain;
            db.energy -= 1;
            db.xp += 5;
            if (db.xp >= db.nextXp) levelUp();
            spawnCoin(e.clientX, e.clientY, "+" + gain);
            update();
            tg.HapticFeedback.impactOccurred('medium');
        } else {
            openMaya("BaÅŸkanÄ±m enerji tÃ¼kendi! HalkÄ±n dinlenmesi gerekiyor.");
        }
    }

    function levelUp() {
        db.lv++;
        db.xp = 0;
        db.nextXp *= 2.2;
        db.energy = 1000;
        openMaya("TEBRÄ°KLER! Seviye atladÄ±k baÅŸkanÄ±m. Åehrin prestiji artÄ±yor!");
    }

    function buy(name, cost, inc) {
        if (db.coins >= cost) {
            db.coins -= cost;
            db.pps += inc;
            update();
            tg.HapticFeedback.notificationOccurred('success');
            openMaya(name + " inÅŸa edildi! Gelirimiz arttÄ± baÅŸkanÄ±m.");
        } else {
            openMaya("BÃ¼tÃ§emiz yetersiz baÅŸkanÄ±m, biraz daha para lazÄ±m.");
        }
    }

    function triggerChance() {
        if (db.coins < 500) return openMaya("Åans kartÄ± iÃ§in 500 coin lazÄ±m.");
        db.coins -= 500;
        const events = [
            { m: "Halktan baÄŸÄ±ÅŸ toplandÄ±! +1000 Coin", a: () => db.coins += 1000 },
            { m: "Ekonomik kriz! -300 Coin", a: () => db.coins = Math.max(0, db.coins - 300) },
            { m: "Maya'dan hediye: Enerji doldu!", a: () => db.energy = 1000 }
        ];
        let e = events[Math.floor(Math.random() * events.length)];
        e.a();
        openMaya(e.m);
        update();
    }

    function openMaya(msg) {
        document.getElementById('maya-msg').innerText = msg;
        document.getElementById('maya-screen').classList.remove('hidden');
    }

    function closeMaya() {
        document.getElementById('maya-screen').classList.add('hidden');
    }

    function spawnCoin(x, y, txt) {
        const div = document.createElement('div');
        div.className = 'floating-coin';
        div.style.left = x + 'px'; div.style.top = y + 'px';
        div.innerText = txt;
        document.body.appendChild(div);
        setTimeout(() => div.remove(), 800);
    }

    setInterval(() => {
        db.coins += (db.pps / 10);
        if (db.energy < 1000) db.energy += 0.4;
        update();
    }, 100);

    window.onload = update;
</script>
</body>
</html>
