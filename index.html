<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>M-Coin City: Final Empire</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --m-red: #E31B23; --m-green: #00A650; --m-blue: #008DCE;
            --m-gold: #FFD700; --space-bg: #0B0D17;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--space-bg);
            color: white;
            margin: 0; padding: 0;
            user-select: none;
            overflow: hidden;
            height: 100vh;
        }

        /* --- UI PANELS --- */
        .header {
            background: var(--m-red);
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 4px solid #000;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
        }

        .stats-container {
            background: white;
            color: #333;
            margin: 10px auto;
            width: 90%;
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            border: 4px solid #333;
            box-shadow: 6px 6px 0px var(--m-blue);
        }

        .coin-val { font-size: 36px; font-weight: 900; color: var(--m-green); }
        .sub-stat { font-size: 12px; font-weight: bold; color: #666; }

        /* --- THE CITY CORE (CLICKER) --- */
        .city-wrapper {
            position: relative;
            width: 220px;
            height: 220px;
            margin: 20px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        #city-visual {
            font-size: 140px;
            transition: transform 0.1s;
            filter: drop-shadow(0 0 20px var(--m-blue));
        }

        .city-wrapper:active #city-visual { transform: scale(0.9); }

        /* --- PROGRESS BARS --- */
        .bars-area { padding: 0 25px; }
        .bar-label { font-size: 10px; font-weight: bold; color: var(--m-gold); margin-bottom: 4px; display: block; }
        .bar-bg { width: 100%; height: 16px; background: #222; border-radius: 8px; border: 2px solid #444; overflow: hidden; margin-bottom: 10px; }
        #energy-fill { width: 100%; height: 100%; background: linear-gradient(90deg, #FFD700, #FFA500); }
        #rocket-fill { width: 0%; height: 100%; background: linear-gradient(90deg, #00C8FF, #008DCE); transition: width 0.4s; }

        /* --- ACTION GRID --- */
        .actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            padding: 15px;
            background: rgba(255,255,255,0.05);
            border-top: 2px solid #333;
        }

        .btn {
            background: white;
            color: #333;
            border: 3px solid #333;
            padding: 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 900;
            text-align: center;
            box-shadow: 4px 4px 0px #000;
        }
        .btn:active { transform: translate(2px, 2px); box-shadow: 0px 0px 0px #000; }
        .btn.blue { background: #E3F2FD; color: var(--m-blue); }

        /* --- MAYA BRIEFING SYSTEM --- */
        #maya-modal {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 10000;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: 0.5s;
        }
        #maya-modal.active { display: flex; }

        .maya-avatar {
            width: 150px;
            height: 150px;
            background: white;
            border-radius: 50%;
            border: 5px solid var(--m-gold);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 100px;
            box-shadow: 0 0 30px var(--m-gold);
        }

        .speech-bubble {
            background: white;
            color: #333;
            border: 4px solid #333;
            padding: 20px;
            border-radius: 20px;
            width: 80%;
            margin-top: 20px;
            font-weight: bold;
            text-align: center;
            box-shadow: 8px 8px 0px var(--m-red);
        }

        .maya-btn {
            margin-top: 25px;
            background: var(--m-gold);
            border: 3px solid #333;
            padding: 12px 40px;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
        }

        /* --- ANIMATIONS --- */
        .float-text {
            position: absolute;
            font-weight: bold;
            color: var(--m-gold);
            animation: riseUp 0.6s forwards;
            pointer-events: none;
        }
        @keyframes riseUp { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-100px); } }
    </style>
</head>
<body>

<div id="maya-modal">
    <div class="maya-avatar">ğŸ‘©â€ğŸ’¼</div>
    <div id="maya-text" class="speech-bubble">...</div>
    <button class="maya-btn" onclick="closeMaya()">EMREDERSÄ°N BAÅKANIM!</button>
</div>

<div class="header">
    <div id="rank-title" style="font-weight: 900;">ğŸŒŒ GALAKTÄ°K Ä°MPARATOR</div>
    <div id="level-display" style="background:white; color:black; padding:2px 8px; border-radius:5px; font-weight:bold;">Lv. 1</div>
</div>

<div class="stats-container">
    <div class="coin-val">ğŸª™ <span id="coins">0</span></div>
    <div class="sub-stat">BORSA DEÄERÄ°: <span id="mcoin-value">1.00</span> USD</div>
</div>

<div class="city-wrapper" onclick="handleTap(event)">
    <div id="city-visual">ğŸ›ï¸</div>
</div>

<div class="bars-area">
    <span class="bar-label">âš¡ REZERV GÃœCÃœ: <span id="en-num">1000</span></span>
    <div class="bar-bg"><div id="energy-fill"></div></div>
    
    <span class="bar-label">ğŸš€ AY GÃ–REVÄ° (ROKET YAKITI)</span>
    <div class="bar-bg"><div id="rocket-fill"></div></div>
</div>

<div class="actions">
    <div class="btn" onclick="buyAsset(500, 10)">ğŸ¦ MERKEZ BANKASI<br>(+10 PPS / 500 ğŸª™)</div>
    <div class="btn blue" onclick="launchRocket()">ğŸš€ ROKETÄ° FIRLAT<br>(KÃ¢rÄ± Katla!)</div>
    <div class="btn" onclick="tradeBonds()">ğŸ“‰ BORSA Ä°ÅLEMÄ°<br>(Risk Al)</div>
    <div class="btn" onclick="claimDaily()">ğŸ GÃœNLÃœK HÄ°BE</div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    let state = JSON.parse(localStorage.getItem('mcity_final_safe')) || {
        coins: 0, pps: 0, energy: 1000, lv: 1, xp: 0, nextXp: 1000,
        rocket: 0, val: 1.0, lastDaily: 0, first: true
    };

    function updateUI() {
        document.getElementById('coins').innerText = Math.floor(state.coins).toLocaleString();
        document.getElementById('mcoin-value').innerText = state.val.toFixed(2);
        document.getElementById('en-num').innerText = Math.floor(state.energy);
        document.getElementById('energy-fill').style.width = (state.energy / 10) + "%";
        document.getElementById('rocket-fill').style.width = state.rocket + "%";
        document.getElementById('level-display').innerText = "Lv. " + state.lv;
        
        // Åehir Evrimi (Emoji DeÄŸiÅŸimi)
        const city = document.getElementById('city-visual');
        if(state.lv < 5) city.innerText = "ğŸ›ï¸";
        else if(state.lv < 10) city.innerText = "ğŸ¢";
        else if(state.lv < 20) city.innerText = "ğŸ™ï¸";
        else city.innerText = "ğŸš€";

        localStorage.setItem('mcity_final_safe', JSON.stringify(state));
    }

    function handleTap(e) {
        if (state.energy >= 1) {
            let gain = (1 + Math.floor(state.lv / 2)) * state.val;
            state.coins += gain;
            state.energy -= 1;
            state.xp += 10;
            state.rocket = Math.min(100, state.rocket + 0.2);
            if (state.xp >= state.nextXp) levelUp();
            showFloat(e.clientX, e.clientY, "+" + gain.toFixed(1));
            updateUI();
            tg.HapticFeedback.impactOccurred('medium');
        } else {
            openMaya("BaÅŸkanÄ±m enerji tÃ¼kendi, sistemlerin ÅŸarj olmasÄ±nÄ± bekleyelim!");
        }
    }

    function levelUp() {
        state.lv++; state.xp = 0; state.nextXp *= 2; state.energy = 1000;
        openMaya("TEBRÄ°KLER! Seviye atladÄ±k baÅŸkanÄ±m. Ä°mparatorluÄŸumuz geniÅŸliyor.");
    }

    function buyAsset(cost, pps) {
        if (state.coins >= cost) {
            state.coins -= cost;
            state.pps += pps;
            openMaya("Yeni bir finansal merkez kuruldu. Gelirimiz artÄ±yor!");
            updateUI();
        } else {
            openMaya("BaÅŸkanÄ±m bÃ¼tÃ§emiz yetersiz, biraz daha M-Coin basalÄ±m.");
        }
    }

    function launchRocket() {
        if(state.rocket < 100) return openMaya("YakÄ±t henÃ¼z %100 deÄŸil baÅŸkanÄ±m!");
        state.rocket = 0;
        state.val += 0.5;
        openMaya("ROKET AY'A ULAÅTI! M-Coin deÄŸeri fÄ±rladÄ±!");
        updateUI();
    }

    function tradeBonds() {
        let win = Math.random() > 0.45;
        if(win) {
            let winAmt = state.coins * 0.2;
            state.coins += winAmt;
            openMaya("Borsa operasyonu baÅŸarÄ±lÄ±! +" + Math.floor(winAmt) + " M-Coin.");
        } else {
            state.coins *= 0.8;
            openMaya("Borsada spekÃ¼lasyon kurbanÄ± olduk, bir miktar kaybettik.");
        }
        updateUI();
    }

    function claimDaily() {
        let now = Date.now();
        if(now - state.lastDaily > 86400000) {
            state.coins += 2000; state.lastDaily = now;
            openMaya("DÃ¼nya Konseyi'nden yÄ±llÄ±k hibe geldi: +2000 M-Coin!");
        } else { openMaya("Yeni bÃ¼tÃ§e dÃ¶nemi henÃ¼z baÅŸlamadÄ±."); }
    }

    function openMaya(txt) {
        document.getElementById('maya-text').innerText = txt;
        document.getElementById('maya-modal').classList.add('active');
    }

    function closeMaya() {
        document.getElementById('maya-modal').classList.remove('active');
    }

    function showFloat(x, y, t) {
        const d = document.createElement('div');
        d.className = 'float-text';
        d.style.left = x + 'px'; d.style.top = y + 'px';
        d.innerText = t;
        document.body.appendChild(d);
        setTimeout(() => d.remove(), 600);
    }

    setInterval(() => {
        state.coins += (state.pps * state.val / 10);
        if (state.energy < 1000) state.energy += 0.8;
        if (state.val > 0.5) state.val -= 0.001; // Enflasyon
        updateUI();
    }, 100);

    window.onload = () => {
        updateUI();
        if(state.first) {
            setTimeout(() => openMaya("HoÅŸ geldiniz SayÄ±n Ä°mparator! Ben Maya. Galaktik hakimiyetimiz bugÃ¼n baÅŸlÄ±yor!"), 800);
            state.first = false;
        }
    };
</script>
</body>
</html>
