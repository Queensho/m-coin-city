<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>M-Coin City: Strategy</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --m-brown: #5d4037; --m-green: #2e7d32; --m-gold: #fbc02d; --bg: #e0e0e0; }
        body { font-family: 'Tahoma', sans-serif; background: var(--bg); margin: 0; padding: 0; user-select: none; color: #333; }

        /* Ãœst Hammadde Paneli */
        .resource-bar {
            background: #3e2723; color: #fff;
            display: grid; grid-template-columns: repeat(4, 1fr);
            padding: 8px; border-bottom: 3px solid #000; font-size: 11px; text-align: center;
        }
        .res-item b { display: block; color: var(--m-gold); }

        /* KÃ¶y GÃ¶rÃ¼nÃ¼mÃ¼ */
        .village-view {
            width: 95%; height: 220px; background: #81c784; margin: 10px auto;
            border: 4px solid #5d4037; border-radius: 15px; position: relative;
            background-image: radial-gradient(#66bb6a 20%, transparent 20%), radial-gradient(#66bb6a 20%, transparent 20%);
            background-size: 40px 40px;
        }

        /* Bina SlotlarÄ± */
        .building-slot {
            position: absolute; width: 50px; height: 50px;
            background: rgba(255,255,255,0.7); border: 2px dashed #5d4037;
            border-radius: 8px; display: flex; align-items: center; justify-content: center;
            font-size: 20px; cursor: pointer; font-weight: bold;
        }
        .slot1 { top: 20px; left: 30px; }
        .slot2 { top: 20px; right: 30px; }
        .slot3 { bottom: 20px; left: 30px; }
        .slot4 { bottom: 20px; right: 30px; }
        .built { background: white; border-style: solid; box-shadow: 0 4px 0 #5d4037; }

        /* Ä°nÅŸaat Listesi */
        .build-queue {
            background: #fff; margin: 10px; padding: 10px; border: 2px solid #333;
            border-radius: 8px; font-size: 12px; display: none;
        }

        /* Sekmeler (Tablar) */
        .tabs {
            display: grid; grid-template-columns: repeat(3, 1fr);
            padding: 10px; gap: 5px; background: #d7ccc8;
        }
        .tab-btn {
            background: #5d4037; color: white; border: none; padding: 10px;
            border-radius: 5px; font-weight: bold; font-size: 11px;
        }

        /* Maya Modal */
        #modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); display: none; align-items: center; justify-content: center; z-index: 1000;
        }
        .modal-content {
            background: #f5f5f5; width: 85%; padding: 20px; border-radius: 15px;
            border: 4px solid #5d4037; text-align: center;
        }
    </style>
</head>
<body>

<div class="resource-bar">
    <div class="res-item"><b>ğŸªµ Odun</b><span id="res-wood">0</span></div>
    <div class="res-item"><b>ğŸ§± TuÄŸla</b><span id="res-clay">0</span></div>
    <div class="res-item"><b>â›“ï¸ Demir</b><span id="res-iron">0</span></div>
    <div class="res-item"><b>ğŸŒ¾ TahÄ±l</b><span id="res-crop">0</span></div>
</div>

<div style="padding: 10px; font-size: 12px; font-weight: bold;">
    ğŸ›ï¸ Åehir: <span id="village-name">Yeni KÃ¶y</span> | ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ NÃ¼fus: <span id="pop">10</span>
</div>

<div class="village-view">
    <div id="slot-1" class="building-slot slot1" onclick="openBuild(1)">+</div>
    <div id="slot-2" class="building-slot slot2" onclick="openBuild(2)">+</div>
    <div id="slot-3" class="building-slot slot3" onclick="openBuild(3)">+</div>
    <div id="slot-4" class="building-slot slot4" onclick="openBuild(4)">+</div>
</div>

<div id="queue" class="build-queue">
    ğŸ—ï¸ Ä°nÅŸaat devam ediyor: <span id="timer">0</span>sn
</div>

<div class="tabs">
    <button class="tab-btn" onclick="openMaya('KÃ¶yÃ¼nÃ¼zÃ¼n genel durumu iyi baÅŸkanÄ±m.')">ğŸ“œ GENEL</button>
    <button class="tab-btn" onclick="openMaya('KÄ±ÅŸla Lv. 3 olduÄŸunda asker basabilirsiniz.')">âš”ï¸ ASKERÄ°</button>
    <button class="tab-btn" onclick="location.reload()">ğŸ”„ YENÄ°LE</button>
</div>

<div id="modal">
    <div class="modal-content">
        <h3 id="modal-title">Bina Ä°nÅŸa Et</h3>
        <div id="build-options">
            <div style="border-bottom: 1px solid #ccc; padding: 10px;">
                <b>ğŸªµ Odun Kesici</b><br>
                Maliyet: 40ğŸªµ 30ğŸ§± 20â›“ï¸<br>
                <button onclick="startBuild('Odun Kesici', 40, 30, 20)">Ä°nÅŸa Et (30sn)</button>
            </div>
            <div style="border-bottom: 1px solid #ccc; padding: 10px;">
                <b>ğŸ¢ Merkez BinasÄ±</b><br>
                Maliyet: 80ğŸªµ 70ğŸ§± 60â›“ï¸<br>
                <button onclick="startBuild('Merkez BinasÄ±', 80, 70, 60)">Ä°nÅŸa Et (60sn)</button>
            </div>
        </div>
        <br>
        <button onclick="closeModal()" style="background:red; color:white; border:none; padding:5px 15px; border-radius:5px;">VazgeÃ§</button>
    </div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    let state = JSON.parse(localStorage.getItem('mcity_travian_v1')) || {
        res: { wood: 100, clay: 100, iron: 100, crop: 100 },
        prod: { wood: 1, clay: 1, iron: 1, crop: 1 },
        slots: { 1: null, 2: null, 3: null, 4: null },
        pop: 10,
        isBuilding: false,
        buildTime: 0
    };

    let selectedSlot = null;

    function updateUI() {
        document.getElementById('res-wood').innerText = Math.floor(state.res.wood);
        document.getElementById('res-clay').innerText = Math.floor(state.res.clay);
        document.getElementById('res-iron').innerText = Math.floor(state.res.iron);
        document.getElementById('res-crop').innerText = Math.floor(state.res.crop);
        document.getElementById('pop').innerText = state.pop;

        for (let i = 1; i <= 4; i++) {
            let s = document.getElementById('slot-' + i);
            if (state.slots[i]) {
                s.innerText = state.slots[i].charAt(0);
                s.classList.add('built');
            }
        }

        if (state.isBuilding) {
            document.getElementById('queue').style.display = 'block';
            document.getElementById('timer').innerText = state.buildTime;
        } else {
            document.getElementById('queue').style.display = 'none';
        }
        localStorage.setItem('mcity_travian_v1', JSON.stringify(state));
    }

    function openBuild(slot) {
        if (state.isBuilding) { tg.showAlert("AynÄ± anda sadece bir inÅŸaat yapabilirsiniz!"); return; }
        if (state.slots[slot]) { tg.showAlert("Bu slotta zaten " + state.slots[slot] + " var!"); return; }
        selectedSlot = slot;
        document.getElementById('modal').style.display = 'flex';
    }

    function startBuild(name, w, c, i) {
        if (state.res.wood >= w && state.res.clay >= c && state.res.iron >= i) {
            state.res.wood -= w; state.res.clay -= c; state.res.iron -= i;
            state.isBuilding = true;
            state.buildTime = name === 'Odun Kesici' ? 30 : 60;
            state.currentBuildingName = name;
            state.currentSlot = selectedSlot;
            closeModal();
            updateUI();
        } else {
            tg.showAlert("Yetersiz hammadde!");
        }
    }

    function closeModal() { document.getElementById('modal').style.display = 'none'; }

    function openMaya(msg) { tg.showAlert("Maya: " + msg); }

    // Ãœretim ve Ä°nÅŸaat DÃ¶ngÃ¼sÃ¼
    setInterval(() => {
        // Hammadde Ãœretimi
        state.res.wood += state.prod.wood / 10;
        state.res.clay += state.prod.clay / 10;
        state.res.iron += state.prod.iron / 10;
        state.res.crop += state.prod.crop / 10;

        // Ä°nÅŸaat ZamanlayÄ±cÄ±sÄ±
        if (state.isBuilding && state.buildTime > 0) {
            state.buildTime--;
            if (state.buildTime <= 0) {
                state.isBuilding = false;
                state.slots[state.currentSlot] = state.currentBuildingName;
                state.pop += 5;
                if(state.currentBuildingName === 'Odun Kesici') state.prod.wood += 5;
                tg.HapticFeedback.notificationOccurred('success');
            }
        }
        updateUI();
    }, 1000);

    updateUI();
</script>
</body>
</html>
