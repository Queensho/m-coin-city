<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>M-Coin City</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --m-red: #e31b23; --m-green: #00a650; --m-blue: #008dce; --bg: #f0e6d2; }
        body { font-family: 'Arial Black', sans-serif; background: var(--bg); margin: 0; padding: 0; user-select: none; overflow-x: hidden; height: 100vh; }

        /* Ãœst Durum Paneli */
        .header { background: var(--m-red); color: white; padding: 12px; display: flex; justify-content: space-between; border-bottom: 5px solid #333; font-size: 12px; }

        /* Ana GÃ¶sterge KartÄ± */
        .main-card { background: white; border: 4px solid #333; margin: 10px auto; width: 90%; padding: 10px; border-radius: 12px; text-align: center; box-shadow: 4px 4px 0px #333; }
        .coin-display { font-size: 36px; color: var(--m-green); font-weight: bold; }
        .income-display { font-size: 12px; color: #666; margin-top: 5px; font-weight: bold; }

        /* Belediye BinasÄ± */
        #city-core { width: 180px; height: 180px; background: white; border: 8px solid #333; margin: 15px auto; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: transform 0.05s; position: relative; }
        #city-core:active { transform: scale(0.92); }
        #city-core img { width: 110px; }

        /* Enerji ve XP BarlarÄ± */
        .bar-container { width: 90%; margin: 5px auto; text-align: left; }
        .bar-label { font-size: 10px; font-weight: bold; margin-bottom: 2px; display: block; }
        .bar-bg { width: 100%; height: 14px; background: #333; border-radius: 7px; overflow: hidden; border: 2px solid #333; margin-bottom: 8px; }
        #energy-fill { width: 100%; height: 100%; background: #fff200; transition: width 0.3s; }
        #xp-fill { width: 0%; height: 100%; background: var(--m-blue); transition: width 0.5s; }

        /* Ä°nÅŸaat MenÃ¼sÃ¼ (Scroll edilebilir) */
        .build-menu { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; padding: 10px; max-height: 200px; overflow-y: auto; }
        .shop-item { background: white; border: 3px solid #333; padding: 8px; border-radius: 10px; text-align: center; font-size: 11px; box-shadow: 3px 3px 0px #333; }
        .shop-item b { display: block; margin-bottom: 4px; }
        .buy-btn { background: var(--m-green); color: white; border: 2px solid #333; width: 100%; padding: 4px; border-radius: 5px; font-weight: bold; cursor: pointer; font-size: 10px; }
        .buy-btn:disabled { background: #ccc; }

        /* Maya Brifing (Ã–nceki stabil yapÄ±) */
        #maya-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 9999; transition: all 0.5s ease; opacity: 1; }
        #maya-screen.hidden { transform: translateY(100%); opacity: 0; pointer-events: none; }
        #maya-img-large { width: 160px; margin-bottom: 15px; }
        #maya-speech { background: white; border: 4px solid #333; padding: 15px; border-radius: 20px; width: 75%; text-align: center; font-weight: bold; font-size: 14px; box-shadow: 6px 6px 0px #333; }
        .maya-ok-btn { margin-top: 20px; background: #fff200; border: 3px solid #333; padding: 12px 30px; border-radius: 10px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<div id="maya-screen">
    <img id="maya-img-large" src="assets/maya.png" onerror="this.src='https://i.ibb.co/v4S8W5p/maya-cartoon.png'">
    <div id="maya-speech">Åehrimizi bir dÃ¼nya baÅŸkenti yapmaya hazÄ±r mÄ±sÄ±nÄ±z?</div>
    <button class="maya-ok-btn" onclick="mayaKapat()">DEVAM ET BAÅKANIM</button>
</div>

<div class="header">
    <div id="rank-tag">ğŸ›ï¸ STAJYER BAÅKAN</div>
    <div id="lv-tag">Lv. 1</div>
</div>

<div class="main-card">
    <div class="coin-display">ğŸª™ <span id="coin-count">0</span></div>
    <div class="income-display">Saatlik KazanÃ§: +<span id="pps-count">0</span> M-Coin</div>
</div>

<div id="city-core" onclick="handleTap(event)">
    <img src="https://cdn-icons-png.flaticon.com/512/619/619153.png">
</div>

<div class="bar-container">
    <span class="bar-label">âš¡ ENERJÄ° REZERVÄ° (<span id="en-text">1000</span>)</span>
    <div class="bar-bg"><div id="energy-fill"></div></div>
    
    <span class="bar-label">ğŸ“ˆ ÅEHÄ°R TECRÃœBESÄ° (XP)</span>
    <div class="bar-bg"><div id="xp-fill"></div></div>
</div>

<div class="build-menu">
    <div class="shop-item">
        <b>ğŸª Mahalle FÄ±rÄ±nÄ±</b>
        <span>+2/sn | 100 ğŸª™</span>
        <button class="buy-btn" onclick="buyBuilding('firin', 100, 2)">Ä°NÅA ET</button>
    </div>
    <div class="shop-item">
        <b>ğŸ¦ Yerel Banka</b>
        <span>+10/sn | 500 ğŸª™</span>
        <button class="buy-btn" onclick="buyBuilding('banka', 500, 10)">Ä°NÅA ET</button>
    </div>
    <div class="shop-item">
        <b>ğŸ­ Fabrika</b>
        <span>+50/sn | 2500 ğŸª™</span>
        <button class="buy-btn" onclick="buyBuilding('fabrika', 2500, 50)">Ä°NÅA ET</button>
    </div>
    <div class="shop-item" style="background:#eee">
        <b>âš”ï¸ SavaÅŸ Ofisi</b>
        <span>Ã‡ok YakÄ±nda!</span>
        <button class="buy-btn" disabled>KÄ°LÄ°TLÄ°</button>
    </div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    let state = JSON.parse(localStorage.getItem('mcity_v8')) || {
        coins: 0, energy: 1000, pps: 0, lv: 1, xp: 0, nextXp: 200
    };

    function updateUI() {
        document.getElementById('coin-count').innerText = Math.floor(state.coins);
        document.getElementById('pps-count').innerText = (state.pps * 3600).toLocaleString();
        document.getElementById('en-text').innerText = Math.floor(state.energy);
        document.getElementById('energy-fill').style.width = (state.energy / 10) + "%";
        document.getElementById('xp-fill').style.width = (state.xp / state.nextXp * 100) + "%";
        document.getElementById('lv-tag').innerText = "Lv. " + state.lv;
        
        if(state.lv > 5) document.getElementById('rank-tag').innerText = "ğŸ™ï¸ ÅEHÄ°R PLANLAMACI";
        if(state.lv > 10) document.getElementById('rank-tag').innerText = "ğŸ’ METROPOL BAÅKANI";
        
        localStorage.setItem('mcity_v8', JSON.stringify(state));
    }

    function mayaKapat() {
        document.getElementById('maya-screen').classList.add('hidden');
        tg.HapticFeedback.notificationOccurred('success');
    }

    function mayaAc(msg) {
        document.getElementById('maya-speech').innerText = msg;
        document.getElementById('maya-screen').classList.remove('hidden');
    }

    function handleTap(e) {
        if (state.energy >= 1) {
            state.coins += (1 + Math.floor(state.lv / 2));
            state.energy -= 1;
            state.xp += 5;
            if (state.xp >= state.nextXp) levelUp();
            updateUI();
            tg.HapticFeedback.impactOccurred('medium');
        } else {
            mayaAc("BaÅŸkanÄ±m, halk yorgun! Enerjinin dolmasÄ±nÄ± bekleyelim.");
        }
    }

    function levelUp() {
        state.lv++;
        state.xp = 0;
        state.nextXp *= 2;
        state.energy = 1000;
        mayaAc("TEBRÄ°KLER! Seviye AtladÄ±k. Åehir artÄ±k daha hÄ±zlÄ± geliÅŸiyor!");
    }

    function buyBuilding(name, cost, income) {
        if (state.coins >= cost) {
            state.coins -= cost;
            state.pps += income;
            updateUI();
            mayaAc("Harika bir yatÄ±rÄ±m! " + name + " ÅŸehrimize kazandÄ±rÄ±ldÄ±.");
        } else {
            mayaAc("Bu inÅŸaat iÃ§in bÃ¼tÃ§emiz henÃ¼z yetersiz baÅŸkanÄ±m.");
        }
    }

    setInterval(() => {
        state.coins += (state.pps / 10);
        if (state.energy < 1000) state.energy += 0.5;
        updateUI();
    }, 100);

    window.onload = updateUI;
</script>
</body>
</html>
