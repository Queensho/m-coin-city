<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>M-Coin City</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --m-red: #d32f2f; --m-green: #1f7a31; --m-blue: #0288d1; --bg: #f4f1ea; }
        body { font-family: 'Arial Rounded MT Bold', sans-serif; background: var(--bg); margin: 0; padding: 0; user-select: none; overflow-x: hidden; }

        /* Ãœst Panel */
        .header { background: var(--m-red); color: white; padding: 12px; border-bottom: 5px solid #8b0000; display: flex; justify-content: space-between; align-items: center; font-weight: bold; }
        
        .balance-card { background: white; border: 3px solid #333; margin: 15px auto; width: 85%; border-radius: 12px; padding: 10px; text-align: center; box-shadow: 5px 5px 0 #333; }
        .coin-val { font-size: 34px; color: var(--m-green); font-weight: bold; }

        /* Belediye BinasÄ± (TÄ±klama AlanÄ±) */
        #city-board { width: 220px; height: 220px; background: white; border: 8px solid #333; border-radius: 50%; margin: 20px auto; display: flex; align-items: center; justify-content: center; cursor: pointer; position: relative; z-index: 5; transition: transform 0.05s; }
        #city-board:active { transform: scale(0.92); }
        #city-img { width: 140px; }

        /* SEKRETER MAYA TASARIMI */
        #maya-container {
            position: fixed;
            bottom: -10px;
            right: -20px;
            width: 180px;
            z-index: 100;
            cursor: pointer;
            transition: transform 0.3s;
        }
        #maya-container:hover { transform: scale(1.05); }
        #maya-img { width: 100%; filter: drop-shadow(5px 5px 10px rgba(0,0,0,0.3)); }

        /* Maya'nÄ±n KonuÅŸma Balonu */
        #maya-bubble {
            position: fixed;
            bottom: 150px;
            right: 120px;
            background: white;
            border: 3px solid #333;
            padding: 10px 15px;
            border-radius: 20px 20px 0 20px;
            font-size: 13px;
            font-weight: bold;
            max-width: 150px;
            display: none;
            z-index: 101;
            box-shadow: 4px 4px 0 rgba(0,0,0,0.2);
        }

        /* Barlar */
        .status-container { padding: 0 20px; }
        .bar-bg { width: 100%; height: 16px; background: #ddd; border-radius: 10px; border: 2px solid #333; margin: 5px 0; overflow: hidden; }
        #energy-fill { width: 100%; height: 100%; background: linear-gradient(90deg, #ff9800, #f57c00); transition: width 0.2s; }

        .floating-text { position: absolute; color: var(--m-green); font-weight: bold; animation: floatUp 0.6s forwards; pointer-events: none; }
        @keyframes floatUp { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-80px); } }
    </style>
</head>
<body>

    <div class="header">
        <span id="rank">Ã‡AYLAK BAÅžKAN</span>
        <span>Lv. 1</span>
    </div>

    <div class="balance-card">
        <div class="coin-val">ðŸª™ <span id="coins">0</span></div>
        <div style="font-size: 12px; font-weight: bold;">Halk Mutlu! Pasif: <span id="pps">0</span>/sn</div>
    </div>

    <div id="city-board" onclick="handleTap(event)">
        <img id="city-img" src="https://cdn-icons-png.flaticon.com/512/619/619153.png" alt="City">
    </div>

    <div class="status-container">
        <div style="font-size: 12px; font-weight: bold;">âš¡ ENERJÄ°: <span id="en-text">1000</span></div>
        <div class="bar-bg"><div id="energy-fill"></div></div>
    </div>

    <div id="maya-bubble">BaÅŸkanÄ±m, yeni bir bina almanÄ±n tam zamanÄ±!</div>
    <div id="maya-container" onclick="mayaTalk()">
        <img id="maya-img" src="https://i.ibb.co/v4S8W5p/maya-cartoon.png" alt="Sekreter Maya">
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        let state = JSON.parse(localStorage.getItem('mcity_maya_save')) || {
            coins: 0, energy: 1000, pps: 0, clickPwr: 1
        };

        function updateUI() {
            document.getElementById('coins').innerText = Math.floor(state.coins);
            document.getElementById('en-text').innerText = Math.floor(state.energy);
            document.getElementById('energy-fill').style.width = (state.energy / 10) + "%";
            document.getElementById('pps').innerText = state.pps;
            localStorage.setItem('mcity_maya_save', JSON.stringify(state));
        }

        function handleTap(e) {
            if (state.energy >= 1) {
                state.coins += state.clickPwr;
                state.energy -= 1;
                showEffect(e.clientX, e.clientY, "+" + state.clickPwr);
                updateUI();
                tg.HapticFeedback.impactOccurred('medium');
            }
        }

        function showEffect(x, y, txt) {
            const el = document.createElement('div');
            el.className = 'floating-text';
            el.style.left = x + 'px'; el.style.top = y + 'px';
            el.innerText = txt;
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 600);
        }

        const mayaQuotes = [
            "BaÅŸkanÄ±m, ÅŸehrimiz harika gÃ¶rÃ¼nÃ¼yor!",
            "TÄ±klamaya devam edin, M-Coinler birikiyor!",
            "Biraz mola mÄ± verseniz? Enerjiniz doluyor.",
            "DiÄŸer ÅŸehirlere saldÄ±rmak iÃ§in hazÄ±r mÄ±sÄ±nÄ±z?",
            "Bakkal amca selamlarÄ±nÄ± iletti!"
        ];

        function mayaTalk() {
            const bubble = document.getElementById('maya-bubble');
            const randomQuote = mayaQuotes[Math.floor(Math.random() * mayaQuotes.length)];
            bubble.innerText = randomQuote;
            bubble.style.display = 'block';
            setTimeout(() => { bubble.style.display = 'none'; }, 3000);
        }

        setInterval(() => {
            state.coins += (state.pps / 10);
            if (state.energy < 1000) state.energy += 0.5;
            updateUI();
        }, 100);

        updateUI();
    </script>
</body>
</html>
