<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>M-Coin City: Empire Strategic</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --m-brown: #3E2723; --m-green: #2E7D32; --m-gold: #FFD600; --m-iron: #455A64; }
        body { font-family: 'Verdana', sans-serif; background: #1A1A1A; margin: 0; padding: 0; color: #FFF; user-select: none; overflow: hidden; }

        /* --- KAYNAK PANELÄ° (GerÃ§ekÃ§i Materyaller) --- */
        .res-top {
            background: linear-gradient(to bottom, #4E342E, #2D1B18);
            display: grid; grid-template-columns: repeat(4, 1fr);
            padding: 10px 5px; border-bottom: 3px solid #000; box-shadow: 0 4px 10px rgba(0,0,0,0.5);
        }
        .res-box { text-align: center; border-right: 1px solid rgba(255,255,255,0.1); }
        .res-box:last-child { border-right: none; }
        .res-box img { width: 24px; height: 24px; filter: drop-shadow(0 2px 2px #000); }
        .res-box span { display: block; font-size: 14px; font-weight: bold; color: var(--m-gold); }

        /* --- STRATEJÄ°K KÃ–Y HARÄ°TASI --- */
        .game-map {
            width: 100%; height: 320px; 
            background: url('https://img.freepik.com/premium-photo/aerial-view-green-fields-meadows-nature-landscape_124507-6818.jpg') center/cover;
            position: relative; border-bottom: 4px solid #000;
        }

        /* Bina AlanlarÄ± (Realistic Plots) */
        .building-site {
            position: absolute; width: 70px; height: 70px;
            background: rgba(255,255,255,0.15); border: 2px solid rgba(255,214,0,0.5);
            border-radius: 50%; display: flex; flex-direction: column; align-items: center; justify-content: center;
            cursor: pointer; transition: 0.3s; backdrop-filter: blur(2px);
        }
        .building-site:hover { background: rgba(255,214,0,0.2); }
        .building-site img { width: 55px; height: 55px; display: none; filter: drop-shadow(0 4px 6px #000); }
        .building-site.active img { display: block; }
        .building-site b { font-size: 9px; text-transform: uppercase; color: #FFF; text-shadow: 1px 1px 2px #000; }

        /* Konumlar */
        .site-1 { top: 30px; left: 20%; } .site-2 { top: 30px; right: 20%; }
        .site-merkez { top: 110px; left: 50%; transform: translateX(-50%); width: 90px; height: 90px; border-color: var(--m-gold); }
        .site-3 { bottom: 30px; left: 20%; } .site-4 { bottom: 30px; right: 20%; }

        /* --- Ä°NÅAAT KUYRUÄU --- */
        .construction-bar {
            background: rgba(0,0,0,0.8); padding: 12px; margin: 10px; border: 1px solid var(--m-gold);
            border-radius: 8px; display: none; text-align: center; font-size: 13px;
        }

        /* --- MAYA STRATEJÄ° PANELÄ° --- */
        .maya-panel {
            background: #2D1B18; padding: 15px; border-top: 3px solid #000;
            display: flex; align-items: center; gap: 15px;
        }
        .maya-avatar { 
            width: 60px; height: 60px; border-radius: 50%; 
            border: 2px solid var(--m-gold); background: url('assets/maya.png') center/cover;
            /* Fallback if local asset is missing */
            background-image: url('https://img.freepik.com/premium-vector/professional-woman-avatar-cartoon-character_24877-44673.jpg'); background-size: cover;
        }
        .maya-speech { flex: 1; font-size: 12px; font-style: italic; color: #CCC; line-height: 1.4; }

        /* --- MODAL (BÄ°NA SEÃ‡Ä°MÄ°) --- */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); display: none; align-items: center; justify-content: center; z-index: 100;
        }
        .modal-body {
            background: #3E2723; width: 85%; border: 3px solid var(--m-gold); border-radius: 15px; padding: 20px;
        }
        .build-item {
            display: flex; align-items: center; gap: 10px; padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .build-item img { width: 45px; height: 45px; border-radius: 5px; }
        .build-info { flex: 1; font-size: 11px; }
        .btn-build { background: var(--m-green); color: white; border: none; padding: 8px 12px; border-radius: 4px; font-weight: bold; }

        /* --- NAV --- */
        .bottom-nav { display: grid; grid-template-columns: repeat(3, 1fr); background: #000; position: fixed; bottom: 0; width: 100%; }
        .nav-item { padding: 15px; text-align: center; font-size: 12px; font-weight: bold; border-top: 2px solid var(--m-brown); }
    </style>
</head>
<body>

<div class="res-top">
    <div class="res-box">
        <img src="https://cdn-icons-png.flaticon.com/512/3561/3561494.png"> <span id="wood-val">200</span>
    </div>
    <div class="res-box">
        <img src="https://cdn-icons-png.flaticon.com/512/9439/9439396.png"> <span id="clay-val">200</span>
    </div>
    <div class="res-box">
        <img src="https://cdn-icons-png.flaticon.com/512/10355/10355447.png"> <span id="iron-val">150</span>
    </div>
    <div class="res-box">
        <img src="https://cdn-icons-png.flaticon.com/512/2316/2316934.png"> <span id="crop-val">150</span>
    </div>
</div>

<div class="game-map">
    <div id="site-1" class="building-site site-1" onclick="openBuild(1)"><b>ARAZÄ° 1</b><img src="https://cdn-icons-png.flaticon.com/512/1423/1423377.png"></div>
    <div id="site-2" class="building-site site-2" onclick="openBuild(2)"><b>ARAZÄ° 2</b><img src="https://cdn-icons-png.flaticon.com/512/10433/10433055.png"></div>
    <div id="site-merkez" class="building-site site-merkez active"><b>MERKEZ</b><img src="https://cdn-icons-png.flaticon.com/512/2099/2099143.png"></div>
    <div id="site-3" class="building-site site-3" onclick="openBuild(3)"><b>ARAZÄ° 3</b><img src=""></div>
    <div id="site-4" class="building-site site-4" onclick="openBuild(4)"><b>ARAZÄ° 4</b><img src=""></div>
</div>

<div id="construction-queue" class="construction-bar">
    ğŸ—ï¸ <span id="current-task">Ä°nÅŸaat Yok</span> - <b id="timer">0</b>sn
</div>

<div class="maya-panel">
    <div class="maya-avatar"></div>
    <div class="maya-speech" id="maya-text">SayÄ±n BaÅŸkan, kÃ¶yÃ¼mÃ¼zÃ¼n kaynak Ã¼retimini artÄ±rmak iÃ§in Odun KampÄ± veya TuÄŸla OcaÄŸÄ± kurmamÄ±zÄ± Ã¶neririm.</div>
</div>

<div id="modal-build" class="modal">
    <div class="modal-body">
        <h3 style="margin-top:0; color:var(--m-gold)">BÄ°NA Ä°NÅA ET</h3>
        
        <div class="build-item">
            <img src="https://cdn-icons-png.flaticon.com/512/1423/1423377.png">
            <div class="build-info">
                <b>ODUN KAMPI</b><br>Ãœretim: +10 Odun/sa<br>Maliyet: 60ğŸªµ 40ğŸ§±
            </div>
            <button class="btn-build" onclick="startConstruction('Odun KampÄ±', 60, 40, 0, 20, 1)">KUR</button>
        </div>

        <div class="build-item">
            <img src="https://cdn-icons-png.flaticon.com/512/10433/10433055.png">
            <div class="build-info">
                <b>TUÄLA OCAÄI</b><br>Ãœretim: +10 TuÄŸla/sa<br>Maliyet: 40ğŸªµ 60ğŸ§±
            </div>
            <button class="btn-build" onclick="startConstruction('TuÄŸla OcaÄŸÄ±', 40, 60, 0, 20, 2)">KUR</button>
        </div>

        <button onclick="closeModal()" style="width:100%; margin-top:15px; background:none; color:#AAA; border:1px solid #AAA; padding:10px; border-radius:5px;">Ä°PTAL</button>
    </div>
</div>

<div class="bottom-nav">
    <div class="nav-item" style="color:var(--m-gold)">KÃ–Y</div>
    <div class="nav-item" onclick="tg.showAlert('SavaÅŸ Sistemi YakÄ±nda!')">ORDU</div>
    <div class="nav-item" onclick="location.reload()">REFRESH</div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    let state = JSON.parse(localStorage.getItem('mcity_empire_final')) || {
        res: { wood: 300, clay: 300, iron: 200, crop: 200 },
        prod: { wood: 5, clay: 5, iron: 2, crop: 2 },
        buildings: { 1: null, 2: null, 3: null, 4: null },
        activeBuild: null
    };

    let selectedPlot = null;

    function updateUI() {
        document.getElementById('wood-val').innerText = Math.floor(state.res.wood);
        document.getElementById('clay-val').innerText = Math.floor(state.res.clay);
        document.getElementById('iron-val').innerText = Math.floor(state.res.iron);
        document.getElementById('crop-val').innerText = Math.floor(state.res.crop);

        // BinalarÄ± yerleÅŸtir
        for (let i = 1; i <= 4; i++) {
            const site = document.getElementById('site-' + i);
            const img = site.querySelector('img');
            if (state.buildings[i]) {
                site.classList.add('active');
                site.querySelector('b').innerText = state.buildings[i];
                if (state.buildings[i] === 'Odun KampÄ±') img.src = "https://cdn-icons-png.flaticon.com/512/1423/1423377.png";
                if (state.buildings[i] === 'TuÄŸla OcaÄŸÄ±') img.src = "https://cdn-icons-png.flaticon.com/512/10433/10433055.png";
            }
        }

        if (state.activeBuild) {
            document.getElementById('construction-queue').style.display = 'block';
            document.getElementById('current-task').innerText = state.activeBuild.name;
            document.getElementById('timer').innerText = state.activeBuild.timeLeft;
        } else {
            document.getElementById('construction-queue').style.display = 'none';
        }
        localStorage.setItem('mcity_empire_final', JSON.stringify(state));
    }

    function openBuild(id) {
        if (state.buildings[id]) return;
        if (state.activeBuild) { tg.showAlert("Åu an devam eden bir inÅŸaat var!"); return; }
        selectedPlot = id;
        document.getElementById('modal-build').style.display = 'flex';
    }

    function closeModal() { document.getElementById('modal-build').style.display = 'none'; }

    function startConstruction(name, w, c, i, time, typeId) {
        if (state.res.wood >= w && state.res.clay >= c) {
            state.res.wood -= w;
            state.res.clay -= c;
            state.activeBuild = { name: name, timeLeft: time, plot: selectedPlot, typeId: typeId };
            closeModal();
            updateUI();
            tg.HapticFeedback.notificationOccurred('success');
        } else {
            tg.showAlert("Yetersiz hammadde baÅŸkanÄ±m!");
        }
    }

    // GerÃ§ek ZamanlÄ± Oyun Motoru
    setInterval(() => {
        // Kaynak Ãœretimi (Otomatik)
        state.res.wood += state.prod.wood / 10;
        state.res.clay += state.prod.clay / 10;
        state.res.iron += state.prod.iron / 10;
        state.res.crop += state.prod.crop / 10;

        // Ä°nÅŸaat Takibi
        if (state.activeBuild) {
            state.activeBuild.timeLeft--;
            if (state.activeBuild.timeLeft <= 0) {
                const b = state.activeBuild;
                state.buildings[b.plot] = b.name;
                if (b.typeId === 1) state.prod.wood += 10;
                if (b.typeId === 2) state.prod.clay += 10;
                state.activeBuild = null;
                document.getElementById('maya-text').innerText = "MÃ¼jde BaÅŸkanÄ±m! " + b.name + " tamamlandÄ±. Ãœretim kapasitemiz arttÄ±!";
            }
        }
        updateUI();
    }, 1000);

    updateUI();
</script>
</body>
</html>
