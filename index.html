<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>M-Coin City: Global Era</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --m-red: #e31b23; --m-green: #00a650; --m-blue: #008dce; --m-gold: #f9a825; --bg: #f4f1ea; }
        body { font-family: 'Arial Black', sans-serif; background: var(--bg); margin: 0; padding: 0; user-select: none; overflow: hidden; height: 100vh; }

        /* Ãœst Panel */
        .top-info { background: #222; color: #fff; font-size: 9px; padding: 4px 15px; display: flex; justify-content: space-between; }
        .header { background: var(--m-red); color: white; padding: 10px; display: flex; justify-content: space-between; border-bottom: 4px solid #333; }

        /* Finansal GÃ¶stergeler */
        .finance-card { background: white; border: 4px solid #333; margin: 10px auto; width: 90%; border-radius: 12px; padding: 10px; text-align: center; box-shadow: 4px 4px 0 #333; }
        .coins { font-size: 30px; color: var(--m-green); font-weight: bold; }
        .multiplier { font-size: 10px; color: var(--m-blue); font-weight: bold; }

        /* Åehir ve Mutluluk */
        .city-box { position: relative; width: 160px; height: 160px; margin: 10px auto; cursor: pointer; }
        #city-visual { width: 100%; transition: 0.1s; }
        .city-box:active #city-visual { transform: scale(0.94); }

        .happy-wrap { padding: 0 25px; margin-bottom: 10px; }
        .bar-bg { width: 100%; height: 10px; background: #333; border-radius: 5px; overflow: hidden; }
        #happy-fill { width: 100%; height: 100%; background: var(--m-green); transition: 0.5s; }

        /* DÄ±ÅŸ GÃ¼Ã§ler ve Diplomasi MenÃ¼sÃ¼ */
        .action-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; padding: 0 15px; }
        .btn-action { background: white; border: 3px solid #333; border-radius: 10px; padding: 10px; font-size: 10px; font-weight: bold; cursor: pointer; box-shadow: 3px 3px 0 #333; }
        .btn-global { background: #bbdefb; border-color: var(--m-blue); }
        .btn-alliance { background: #c8e6c9; border-color: var(--m-green); }

        /* Maya Modal */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 9999; display: none; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
        .modal.active { display: flex; }
        .maya-img { width: 150px; border-radius: 50%; border: 4px solid var(--m-gold); }
        .speech { background: white; color: #333; padding: 20px; border-radius: 20px; width: 80%; margin: 15px 0; border: 4px solid #333; font-weight: bold; }
        .btn-ok { background: var(--m-gold); border: 3px solid #333; padding: 10px 30px; border-radius: 10px; font-weight: bold; }

    </style>
</head>
<body>

<div class="top-info">
    <span>ğŸŒ KÃœRESEL PAZAR: AKTÄ°F</span>
    <span id="investor-count">YATIRIMCI: 0</span>
</div>

<div class="header">
    <div id="rank">ğŸŒ KÃœRESEL ADAY</div>
    <div id="lv">Lv. 1</div>
</div>

<div class="finance-card">
    <div class="coins">ğŸª™ <span id="coin-txt">0</span></div>
    <div class="multiplier">KÃœRESEL Ã‡ARPAN: x<span id="mult-txt">1.0</span></div>
</div>

<div class="city-box" onclick="tapCity(event)">
    <img id="city-visual" src="https://cdn-icons-png.flaticon.com/512/619/619153.png">
</div>

<div class="happy-wrap">
    <div style="font-size: 9px; font-weight: bold;">HALK MEMNUNÄ°YETÄ°: <span id="hp-txt">%100</span></div>
    <div class="bar-bg"><div id="happy-fill"></div></div>
</div>

<div class="action-grid">
    <div class="btn-action btn-global" onclick="attractInvestors()">ğŸ¢ YABANCI YATIRIM Ã‡EK<br>(-500 ğŸª™ / +PPS)</div>
    <div class="btn-action btn-alliance" onclick="startTrade()">ğŸ¤ TÄ°CARET ANLAÅMASI<br>(Rastgele Bonus)</div>
    <div class="btn-action" onclick="organizeFestival()">ğŸ­ HALK FESTÄ°VALÄ°<br>(Mutluluk ArtÄ±rÄ±r)</div>
    <div class="btn-action" onclick="claimDaily()">ğŸ’° GÃœNLÃœK HÄ°BE</div>
</div>

<div id="maya-modal" class="modal">
    <img src="assets/maya.png" class="maya-img" onerror="this.src='https://i.ibb.co/v4S8W5p/maya-cartoon.png'">
    <div id="maya-msg" class="speech">...</div>
    <button class="btn-ok" onclick="closeMaya()">EMRET!</button>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    let state = JSON.parse(localStorage.getItem('mcity_v11')) || {
        coins: 0, pps: 2, energy: 1000, lv: 1, xp: 0, nextXp: 500, happy: 100, investors: 0, multiplier: 1.0, lastDaily: 0
    };

    function update() {
        document.getElementById('coin-txt').innerText = Math.floor(state.coins).toLocaleString();
        document.getElementById('mult-txt').innerText = state.multiplier.toFixed(1);
        document.getElementById('hp-txt').innerText = "%" + Math.floor(state.happy);
        document.getElementById('happy-fill').style.width = state.happy + "%";
        document.getElementById('investor-count').innerText = "YATIRIMCI: " + state.investors;
        document.getElementById('lv').innerText = "Lv. " + state.lv;
        
        localStorage.setItem('mcity_v11', JSON.stringify(state));
    }

    function tapCity(e) {
        if (state.energy >= 1) {
            state.coins += (1 + Math.floor(state.lv / 2)) * state.multiplier;
            state.energy -= 1;
            state.xp += 10;
            if (state.xp >= state.nextXp) levelUp();
            update();
            tg.HapticFeedback.impactOccurred('light');
        } else {
            openMaya("BaÅŸkanÄ±m enerji tÃ¼kendi. YatÄ±rÄ±mcÄ±lar yorgun lider sevmez!");
        }
    }

    function levelUp() {
        state.lv++; state.xp = 0; state.nextXp *= 2; state.energy = 1000;
        openMaya("MUHTEÅEM! Åehrimiz artÄ±k kÃ¼resel bir marka haline geldi.");
    }

    function attractInvestors() {
        if(state.coins < 500) return openMaya("YatÄ±rÄ±mcÄ±larÄ± Ã§ekmek iÃ§in reklam bÃ¼tÃ§esi (500 M-Coin) lazÄ±m!");
        state.coins -= 500;
        state.investors += 1;
        state.pps += 10;
        state.multiplier += 0.1;
        openMaya("YabancÄ± bir holding ÅŸehrimize ÅŸube aÃ§tÄ±! Gelirimiz ve Ã§arpanÄ±mÄ±z arttÄ±.");
        update();
    }

    function startTrade() {
        let win = Math.random() > 0.5;
        if(win) {
            let gift = state.lv * 200;
            state.coins += gift;
            openMaya("TÄ°CARET ZAFERÄ°! Ä°hracat rekoru kÄ±rdÄ±k ve " + gift + " M-Coin kazandÄ±k.");
        } else {
            state.happy -= 5;
            openMaya("TÄ°CARET SAVAÅI! GÃ¼mrÃ¼k vergileri halkÄ± mutsuz etti.");
        }
        update();
    }

    function organizeFestival() {
        if(state.coins < 300) return openMaya("Halk festival bekliyor ama kasa boÅŸ!");
        state.coins -= 300;
        state.happy = Math.min(100, state.happy + 15);
        openMaya("Halk sokaklarda kutlama yapÄ±yor! Mutluluk seviyemiz arttÄ±.");
        update();
    }

    function claimDaily() {
        let now = Date.now();
        if(now - state.lastDaily > 86400000) {
            state.coins += 1000; state.lastDaily = now;
            openMaya("DÃ¼nya BankasÄ±'ndan kalkÄ±nma hibesi geldi: +1000 M-Coin!");
        } else { openMaya("BaÅŸkanÄ±m, yeni hibe yarÄ±n gelecek."); }
    }

    function openMaya(m) {
        document.getElementById('maya-msg').innerText = m;
        document.getElementById('maya-modal').classList.add('active');
    }
    function closeMaya() { document.getElementById('maya-modal').classList.remove('active'); }

    setInterval(() => {
        let efficiency = state.happy / 100;
        state.coins += (state.pps * efficiency * state.multiplier / 10);
        if (state.energy < 1000) state.energy += 0.8;
        if (state.happy > 10) state.happy -= 0.02; // Zamanla azalma
        update();
    }, 100);

    window.onload = update;
</script>
</body>
</html>
