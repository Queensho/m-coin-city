<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>M-Coin City: Empire Era</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --m-red: #e31b23; --m-green: #00a650; --m-blue: #008dce; --m-gold: #f9a825; --bg: #f0e6d2; }
        body { font-family: 'Arial Black', sans-serif; background: var(--bg); margin: 0; padding: 0; user-select: none; overflow: hidden; height: 100vh; }

        /* Header & Level Info */
        .header { background: var(--m-red); color: white; padding: 10px; display: flex; justify-content: space-between; border-bottom: 5px solid #222; font-size: 11px; }
        
        /* Stats Dashboard */
        .stats-dashboard { background: white; border: 4px solid #333; margin: 10px auto; width: 92%; border-radius: 15px; padding: 12px; text-align: center; box-shadow: 6px 6px 0px #333; position: relative; }
        .coin-val { font-size: 34px; color: var(--m-green); font-weight: bold; }
        .bonus-info { font-size: 11px; color: var(--m-blue); font-weight: bold; }

        /* Evolution City Core */
        #city-evolution { width: 190px; height: 190px; background: white; border: 8px solid #333; margin: 15px auto; border-radius: 50%; display: flex; align-items: center; justify-content: center; position: relative; transition: 0.1s; cursor: pointer; box-shadow: 0 8px 15px rgba(0,0,0,0.1); }
        #city-evolution:active { transform: scale(0.94); }
        #city-img { width: 120px; transition: 0.5s; }

        /* Progress Bars */
        .bars-container { padding: 0 20px; }
        .progress-label { font-size: 9px; font-weight: bold; margin-bottom: 2px; display: block; }
        .progress-bg { width: 100%; height: 15px; background: #333; border-radius: 8px; border: 2px solid #333; overflow: hidden; margin-bottom: 6px; }
        #energy-fill { width: 100%; height: 100%; background: var(--m-gold); transition: 0.2s; }
        #xp-fill { width: 0%; height: 100%; background: var(--m-blue); transition: 0.5s; }

        /* Bottom Action Menu */
        .action-bar { display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; padding: 10px; background: #fff; border-top: 4px solid #333; position: fixed; bottom: 0; width: 100%; box-sizing: border-box; }
        .action-item { background: #eee; border: 2px solid #333; padding: 8px 2px; border-radius: 8px; font-size: 9px; font-weight: bold; text-align: center; cursor: pointer; }
        .action-item.raid { background: #ffcdd2; color: #b71c1c; }

        /* Maya & Event Overlays */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.92); z-index: 10000; display: none; flex-direction: column; align-items: center; justify-content: center; text-align: center; color: white; }
        .modal.active { display: flex; }
        .maya-pic { width: 160px; margin-bottom: 15px; border-radius: 50%; border: 4px solid var(--m-gold); }
        .speech { background: white; color: #333; border: 4px solid #333; padding: 20px; border-radius: 20px; width: 80%; font-weight: bold; font-size: 14px; box-shadow: 8px 8px 0 var(--m-red); }
        .confirm-btn { margin-top: 25px; background: var(--m-gold); border: 3px solid #333; padding: 12px 40px; border-radius: 12px; font-weight: bold; color: #333; cursor: pointer; }

        .floating { position: absolute; font-weight: bold; color: var(--m-green); animation: rise 0.7s forwards; pointer-events: none; }
        @keyframes rise { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-100px); } }
    </style>
</head>
<body>

<div class="header">
    <div id="user-rank">ğŸ›ï¸ METROPOL ADAYI</div>
    <div id="user-lv">Lv. 1</div>
</div>

<div class="stats-dashboard">
    <span class="coin-val">ğŸª™ <span id="coin-val">0</span></span>
    <div class="bonus-info">Pasif: +<span id="pps-val">0</span>/sn</div>
</div>

<div id="city-evolution" onclick="handleTap(event)">
    <img id="city-img" src="https://cdn-icons-png.flaticon.com/512/619/619153.png">
</div>

<div class="bars-container">
    <span class="progress-label">âš¡ REZERV ENERJÄ°: <span id="en-num">1000</span></span>
    <div class="progress-bg"><div id="energy-fill"></div></div>
    <span class="progress-label">ğŸ“ˆ ÅEHÄ°R PRESTÄ°JÄ° (XP)</span>
    <div class="progress-bg"><div id="xp-fill"></div></div>
</div>

<div class="action-bar">
    <div class="action-item" onclick="openMaya('YatÄ±rÄ±m menÃ¼sÃ¼ Ã§ok yakÄ±nda! Åimdilik tÄ±kla baÅŸkan!')">ğŸ—ï¸ Ä°NÅA</div>
    <div class="action-item raid" onclick="startRaid()">âš”ï¸ AKIN YAP</div>
    <div class="action-item" onclick="claimDaily()">ğŸ BONUS</div>
    <div class="action-item" onclick="openMaya('KÃ¼resel pazar Lv. 5\'te aÃ§Ä±lacak!')">ğŸ’° MARKET</div>
</div>

<div id="maya-modal" class="modal">
    <img src="assets/maya.png" class="maya-pic" onerror="this.src='https://i.ibb.co/v4S8W5p/maya-cartoon.png'">
    <div id="maya-text" class="speech">HoÅŸ geldiniz BaÅŸkanÄ±m! Åehrimiz iÃ§in yeni bir gÃ¼n baÅŸlÄ±yor.</div>
    <button class="confirm-btn" onclick="closeMaya()">TAMAMDIR</button>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    let state = JSON.parse(localStorage.getItem('mcity_empire_v1')) || {
        coins: 0, energy: 1000, pps: 0, lv: 1, xp: 0, nextXp: 500, lastDaily: 0
    };

    function update() {
        document.getElementById('coin-val').innerText = Math.floor(state.coins).toLocaleString();
        document.getElementById('pps-val').innerText = state.pps.toFixed(1);
        document.getElementById('en-num').innerText = Math.floor(state.energy);
        document.getElementById('energy-fill').style.width = (state.energy / 10) + "%";
        document.getElementById('xp-fill').style.width = (state.xp / state.nextXp * 100) + "%";
        document.getElementById('user-lv').innerText = "Lv. " + state.lv;
        
        // GÃ¶rsel Evrim Senaryosu
        const img = document.getElementById('city-img');
        if(state.lv >= 5) {
            img.src = "https://cdn-icons-png.flaticon.com/512/2099/2099143.png"; // Modern Bina
            document.getElementById('user-rank').innerText = "ğŸ¢ ÅEHÄ°R PLANLAMACI";
        }
        if(state.lv >= 10) {
            img.src = "https://cdn-icons-png.flaticon.com/512/2942/2942581.png"; // GÃ¶kdelen/Saray
            document.getElementById('user-rank').innerText = "ğŸ’ Ä°MPARATORLUK BAÅKANI";
        }

        localStorage.setItem('mcity_empire_v1', JSON.stringify(state));
    }

    function handleTap(e) {
        if (state.energy >= 1) {
            let gain = 1 + Math.floor(state.lv / 2);
            state.coins += gain;
            state.energy -= 1;
            state.xp += 10;
            if (state.xp >= state.nextXp) levelUp();
            showEffect(e.clientX, e.clientY, "+" + gain);
            update();
            tg.HapticFeedback.impactOccurred('medium');
        } else {
            openMaya("BaÅŸkanÄ±m enerji tÃ¼kendi, halkÄ±n dinlenmesi gerekiyor!");
        }
    }

    function levelUp() {
        state.lv++;
        state.xp = 0;
        state.nextXp *= 2.5;
        state.energy = 1000;
        openMaya("MUHTEÅEM! Åehrimiz seviye atladÄ±. Mimari yapÄ±mÄ±z geliÅŸiyor!");
    }

    function startRaid() {
        if(state.coins < 100) return openMaya("AkÄ±n yapmak iÃ§in en az 100 M-Coin lazÄ±m!");
        let success = Math.random() > 0.5;
        if(success) {
            let loot = Math.floor(state.coins * 0.15) + 50;
            state.coins += loot;
            openMaya("ZAFER! BaÅŸka bir ÅŸehirden " + loot + " M-Coin ganimet topladÄ±k!");
        } else {
            let loss = 100;
            state.coins -= loss;
            openMaya("BOZGUN! AkÄ±n baÅŸarÄ±sÄ±z oldu, " + loss + " M-Coin kaybettik.");
        }
        update();
    }

    function claimDaily() {
        let now = Date.now();
        if(now - state.lastDaily > 86400000) { // 24 Saat
            state.coins += 500;
            state.lastDaily = now;
            openMaya("GÃ¼nlÃ¼k bÃ¼tÃ§e desteÄŸi geldi: +500 M-Coin!");
            update();
        } else {
            openMaya("BaÅŸkanÄ±m, yeni bÃ¼tÃ§e yarÄ±n sabah gelecek.");
        }
    }

    function openMaya(m) {
        document.getElementById('maya-text').innerText = m;
        document.getElementById('maya-modal').classList.add('active');
    }

    function closeMaya() {
        document.getElementById('maya-modal').classList.remove('active');
    }

    function showEffect(x, y, t) {
        const div = document.createElement('div');
        div.className = 'floating';
        div.style.left = x + 'px'; div.style.top = y + 'px';
        div.innerText = t;
        document.body.appendChild(div);
        setTimeout(() => div.remove(), 700);
    }

    setInterval(() => {
        state.coins += (state.pps / 10);
        if (state.energy < 1000) state.energy += 0.5;
        update();
    }, 100);

    window.onload = update;
</script>
</body>
</html>
