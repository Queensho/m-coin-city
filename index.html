<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>M-Coin City</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --m-red: #E31B23; --m-green: #00A650; --m-blue: #008DCE; --m-yellow: #FFF200; --bg: #F0E6D2; }
        body { font-family: 'Arial Black', sans-serif; background: var(--bg); margin: 0; padding: 0; user-select: none; color: #333; overflow: hidden; }
        
        /* Monopoly Stil Panel */
        .top-bar { background: var(--m-red); color: white; padding: 10px; border-bottom: 5px solid #333; display: flex; justify-content: space-between; align-items: center; }
        .balance-box { background: white; border: 4px solid #333; margin: 15px; padding: 15px; border-radius: 10px; text-align: center; box-shadow: 6px 6px 0px #333; }
        .coin-val { font-size: 38px; color: var(--m-green); }

        /* Ana Åehir Butonu */
        #city-board { width: 220px; height: 220px; background: white; border: 10px solid #333; margin: 20px auto; position: relative; cursor: pointer; display: flex; align-items: center; justify-content: center; transform: rotate(-2deg); box-shadow: 10px 10px 0px rgba(0,0,0,0.1); transition: transform 0.1s; }
        #city-board:active { transform: rotate(-2deg) scale(0.95); }
        #city-board img { width: 140px; }

        /* Enerji ve XP */
        .status-container { padding: 0 20px; }
        .bar { width: 100%; height: 20px; background: #333; border-radius: 10px; overflow: hidden; margin-bottom: 10px; border: 2px solid #333; }
        #energy-fill { width: 100%; height: 100%; background: var(--m-yellow); transition: width 0.3s; }
        #xp-fill { width: 0%; height: 100%; background: var(--m-blue); transition: width 0.5s; }

        /* MenÃ¼ */
        .menu-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 20px; }
        .menu-item { background: white; border: 3px solid #333; border-radius: 8px; padding: 10px; text-align: center; font-size: 12px; font-weight: bold; }
        .menu-item button { background: var(--m-green); color: white; border: 2px solid #333; width: 100%; padding: 5px; margin-top: 5px; cursor: pointer; font-weight: bold; }

        /* Diyalog Kutusu (Maya) */
        #dialog-box { position: fixed; bottom: 20px; left: 10px; right: 10px; background: white; border: 4px solid #333; padding: 15px; border-radius: 10px; display: none; z-index: 100; box-shadow: 5px 5px 0px #333; }
        
        .floating-coin { position: absolute; font-size: 24px; color: var(--m-green); pointer-events: none; animation: floatUp 0.7s forwards; font-weight: bold; }
        @keyframes floatUp { 0% { transform: translateY(0); opacity: 1; } 100% { transform: translateY(-100px); opacity: 0; } }
    </style>
</head>
<body>

<div class="top-bar">
    <div id="rank">BAÅKAN YARDIMCISI</div>
    <div id="level">Lv. 1</div>
</div>

<div class="balance-box">
    <div style="font-size: 14px; font-weight: bold;">TOPLAM M-COIN</div>
    <div class="coin-val">ğŸª™ <span id="coins">0</span></div>
</div>

<div id="city-board" onclick="handleTap(event)">
    <img src="https://cdn-icons-png.flaticon.com/512/619/619153.png">
</div>

<div class="status-container">
    <div style="font-size: 12px; font-weight: bold;">âš¡ ENERJÄ°: <span id="energy-num">1000</span></div>
    <div class="bar"><div id="energy-fill"></div></div>
    <div style="font-size: 12px; font-weight: bold;">ğŸ“ˆ ÅEHÄ°R XP</div>
    <div class="bar"><div id="xp-fill"></div></div>
</div>

<div class="menu-grid">
    <div class="menu-item">ğŸª LÄ°MONATACI<br>+2/sn<br><button onclick="buy('limon', 100, 2)">100 ğŸª™</button></div>
    <div class="menu-item">âš”ï¸ DÄ°PLOMASÄ°<br>SavaÅŸ & BarÄ±ÅŸ<br><button onclick="triggerWar()">SALDIR!</button></div>
</div>

<div id="dialog-box" onclick="closeDialog()">
    <strong id="maya-name">Maya:</strong> <span id="maya-text"></span>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    let data = JSON.parse(localStorage.getItem('m_city_pro')) || {
        coins: 0, energy: 1000, maxEnergy: 1000, pps: 0, xp: 0, nextXp: 500, lv: 1, firstTime: true
    };

    function updateUI() {
        document.getElementById('coins').innerText = Math.floor(data.coins);
        document.getElementById('energy-num').innerText = Math.floor(data.energy);
        document.getElementById('energy-fill').style.width = (data.energy / data.maxEnergy * 100) + "%";
        document.getElementById('xp-fill').style.width = (data.xp / data.nextXp * 100) + "%";
        document.getElementById('level').innerText = "Lv. " + data.lv;
        localStorage.setItem('m_city_pro', JSON.stringify(data));
    }

    function handleTap(e) {
        if (data.energy >= 1) {
            data.coins += (1 + data.lv);
            data.energy -= 1;
            data.xp += 5;
            if (data.xp >= data.nextXp) levelUp();
            showCoin(e.clientX, e.clientY);
            updateUI();
            tg.HapticFeedback.impactOccurred('medium');
        }
    }

    function levelUp() {
        data.lv++;
        data.xp = 0;
        data.nextXp *= 2.5;
        data.maxEnergy += 500;
        data.energy = data.maxEnergy;
        mayaKonus("TEBRÄ°KLER BAÅKAN! Seviye atladÄ±k. Åehir bÃ¼yÃ¼yor!");
    }

    function buy(item, price, income) {
        if (data.coins >= price) {
            data.coins -= price;
            data.pps += income;
            updateUI();
            mayaKonus("Harika bir yatÄ±rÄ±m! ArtÄ±k daha Ã§ok kazanÄ±yoruz.");
        } else { tg.showAlert("Daha fazla M-Coin lazÄ±m!"); }
    }

    function triggerWar() {
        if (data.coins < 50) return;
        let win = Math.random() > 0.5;
        if (win) {
            let gain = Math.floor(data.coins * 0.2);
            data.coins += gain;
            mayaKonus("ZAFER! DiÄŸer ÅŸehirden " + gain + " M-Coin Ã§aldÄ±k!");
        } else {
            data.coins = Math.max(0, data.coins - 50);
            mayaKonus("Bozguna uÄŸradÄ±k baÅŸkanÄ±m... 50 M-Coin kaybettik.");
        }
        updateUI();
    }

    function mayaKonus(text) {
        document.getElementById('maya-text').innerText = text;
        document.getElementById('dialog-box').style.display = 'block';
    }

    function closeDialog() { document.getElementById('dialog-box').style.display = 'none'; }

    function showCoin(x, y) {
        const c = document.createElement('div');
        c.className = 'floating-coin';
        c.innerText = 'ğŸª™';
        c.style.left = x + 'px'; c.style.top = y + 'px';
        document.body.appendChild(c);
        setTimeout(() => c.remove(), 700);
    }

    // Ä°lk GiriÅŸ Senaryosu
    if (data.firstTime) {
        setTimeout(() => {
            mayaKonus("HoÅŸ geldiniz SayÄ±n BaÅŸkan! Ben Maya. Bu yÄ±kÄ±k ÅŸehri beraber ayaÄŸa kaldÄ±racaÄŸÄ±z. Belediye binasÄ±na dokunarak baÅŸlayalÄ±m!");
            data.firstTime = false;
            updateUI();
        }, 1000);
    }

    setInterval(() => {
        data.coins += (data.pps / 10);
        if (data.energy < data.maxEnergy) data.energy += 0.5;
        updateUI();
    }, 100);

    updateUI();
</script>
</body>
</html>
